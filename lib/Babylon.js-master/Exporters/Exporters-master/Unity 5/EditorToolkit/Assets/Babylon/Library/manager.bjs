var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),BABYLON;!function(e){var t=function(){function t(e,t,n,a){if(void 0===n&&(n=!0),void 0===a&&(a={}),this.register=null,this.dispose=null,this.tick=!1,this._engine=null,this._scene=null,this._before=null,this._after=null,this._started=!1,this._initialized=!1,this._properties=null,this._manager=null,this.owned=null,null==e)throw new Error("Null owner scene obejct specified.");if(null==t)throw new Error("Null host scene obejct specified.");this.tick=n,this.owned=e,this._started=!1,this._manager=null,this._initialized=!1,this._properties=a,this._engine=t.getEngine(),this._scene=t;var r=this;r.register=function(){r.registerInstance(r)},r._before=function(){r.updateInstance(r)},r._after=function(){r.afterInstance(r)},r.dispose=function(){r.disposeInstance(r)}}return t.prototype.start=function(){},t.prototype.update=function(){},t.prototype.after=function(){},t.prototype.destroy=function(){},Object.defineProperty(t.prototype,"scene",{get:function(){return this._scene},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"engine",{get:function(){return this._engine},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"manager",{get:function(){return null==this._manager&&(this._manager=e.SceneManager.GetInstance()),this._manager},enumerable:!0,configurable:!0}),t.prototype.setProperty=function(e,t){null!=this._properties&&(this._properties[e]=t)},t.prototype.getProperty=function(e,t){void 0===t&&(t=null);var n=null;return null!=this._properties&&(n=this._properties[e]),null==n&&(n=t),null!=n?n:null},t.prototype.getClassname=function(){var e=/function (.{1,})\(/,t=e.exec(this.constructor.toString());return t&&t.length>1?t[1]:""},t.prototype.getMetadata=function(){return this.manager.findSceneMetadata(this.owned)},t.prototype.getComponent=function(e){var t=this.manager.findSceneComponent(e,this.owned);return null!=t?t:null},t.prototype.getComponents=function(e){var t=this.manager.findSceneComponents(e,this.owned);return null!=t?t:null},t.prototype.getLensFlareSystem=function(e){return this.manager.findSceneLensFlareSystem(e,this.owned)},t.prototype.getLensFlareSystems=function(){return this.manager.findSceneLensFlareSystems(this.owned)},t.prototype.init=function(){null!=this.owned.metadata},t.prototype.registerInstance=function(e){e.ready&&e.manager.onready(function(){e.ready()}),e.scene.registerBeforeRender(e._before),e.scene.registerAfterRender(e._after)},t.prototype.updateInstance=function(e){e._started?e._started&&e.tick&&(e.update(),e.updateIntersectionList&&e.updateIntersectionList()):(e.init(),e.start(),e._started=!0)},t.prototype.afterInstance=function(e){e._started&&e.tick&&e.after()},t.prototype.disposeInstance=function(e){e.scene.unregisterBeforeRender(e._before),e.scene.unregisterAfterRender(e._after),e.disposeSceneComponent&&e.disposeSceneComponent(),null!=e._prefab&&(e._prefab.dispose(),e._prefab=null),e.destroy(),e.tick=!1,e.owned=null,e._started=!1,e._before=null,e._after=null,e._properties=null,e._engine=null,e._scene=null,e._manager=null,e.register=null,e.dispose=null},t}();e.SceneComponent=t;var n=function(t){function n(e,n,a,r){void 0===a&&(a=!0),void 0===r&&(r={});var i=t.call(this,e,n,a,r)||this;return i._camera=null,i._orthoSize=0,i._orthoUpdate=!1,i._camera=e,i}return __extends(n,t),Object.defineProperty(n.prototype,"camera",{get:function(){return this._camera},enumerable:!0,configurable:!0}),n.prototype.setupOrthographicCamera=function(t,n){null!=this.camera&&this._camera.mode===e.Camera.ORTHOGRAPHIC_CAMERA&&(this._orthoSize=t,this.updateOrthographicSize(),this._orthoUpdate===!1&&(this._orthoUpdate=n,this._orthoUpdate===!0&&window.addEventListener("resize",this.updateOrthographicSize)))},n.prototype.updateOrthographicSize=function(){if(null!=this.camera&&0!==this._orthoSize){var e=this.scene.getEngine().getRenderingCanvasClientRect(),t=e.width/e.height,n=this._orthoSize,a=n*t;this._camera.orthoTop=n,this._camera.orthoBottom=-n,this._camera.orthoLeft=-a,this._camera.orthoRight=a}},n.prototype.disposeSceneComponent=function(){this._orthoUpdate===!0&&(window.removeEventListener("resize",this.updateOrthographicSize),this._orthoUpdate=!1,this._orthoSize=0),null!=this._camera.metadata&&null!=this._camera.metadata.properties&&null!=this._camera.metadata.properties.hdrPipeline&&(this._camera.metadata.properties.hdrPipeline=null),this._camera=null},n}(e.SceneComponent);e.CameraComponent=n;var a=function(e){function t(t,n,a,r){void 0===a&&(a=!0),void 0===r&&(r={});var i=e.call(this,t,n,a,r)||this;return i._light=null,i._light=t,i}return __extends(t,e),Object.defineProperty(t.prototype,"light",{get:function(){return this._light},enumerable:!0,configurable:!0}),t.prototype.disposeSceneComponent=function(){this._light=null},t}(e.SceneComponent);e.LightComponent=a;var r=function(t){function n(n,a,r,i){void 0===r&&(r=!0),void 0===i&&(i={});var o=t.call(this,n,a,r,i)||this;return o.onIntersectionEnter=null,o.onIntersectionStay=null,o.onIntersectionExit=null,o.intersectionPrecision=e.IntersectionPrecision.AABB,o._intersections=[],o._intersecting=!1,o._intersector=null,o._mesh=null,o._mesh=n,o._intersecting=!1,o}return __extends(n,t),Object.defineProperty(n.prototype,"mesh",{get:function(){return this._mesh},enumerable:!0,configurable:!0}),n.prototype.getChildMesh=function(t,n,a,r){return void 0===n&&(n=e.SearchType.ExactMatch),void 0===a&&(a=!0),void 0===r&&(r=null),this.manager.findSceneChildMesh(t,this._mesh,n,a,r)},n.prototype.getCollisionMesh=function(e,t){return void 0===e&&(e=!0),void 0===t&&(t=null),this.manager.findSceneCollisionMesh(this._mesh,e,t)},n.prototype.getSocketMesh=function(e,t,n){return void 0===t&&(t=!0),void 0===n&&(n=null),this.manager.findSceneSocketMesh(e,this._mesh,t,n)},n.prototype.getSocketMeshes=function(e,t){return void 0===e&&(e=!0),void 0===t&&(t=null),this.manager.findSceneSocketMeshes(this._mesh,e,t)},n.prototype.getParticleSystem=function(e){return this.manager.findSceneParticleSystem(e,this._mesh)},n.prototype.getParticleSystems=function(){return this.manager.findSceneParticleSystems(this._mesh)},n.prototype.onCollisionEvent=function(t){if(null!=this._mesh.metadata&&this._mesh.metadata.api&&(this._mesh.metadata.collisionEvent=t),null!=this._mesh.physicsImpostor){var n=this._mesh.physicsImpostor;null==n.onCollideEvent&&(n.onCollideEvent=this.updatePhysicsCollisionEvent)}else e.Tools.Warn("Physics imposter not defined for mesh: "+this.mesh.name)},n.prototype.getCollisionEventHandler=function(){var e=null;return null!=this._mesh.metadata&&this._mesh.metadata.api&&null!=this._mesh.metadata.collisionEvent&&(e=this._mesh.metadata.collisionEvent),e},n.prototype.updatePhysicsCollisionEvent=function(e,t){if(null!=e.object&&null!=t.object){var n=e.object;if(null!=n&&null!=n.metadata&&null!=n.metadata.collisionEvent){var a=t.object;if(null!=a){var r="Untagged";null!=a.metadata&&null!=a.metadata.tagName&&""!==a.metadata.tagName&&(r=a.metadata.tagName),n.metadata.collisionEvent(a,r)}}}},n.prototype.addIntersectionMesh=function(e){if(null!=e){var t=this.manager.findSceneCollisionMesh(e);null!=t&&this._intersections.push({mesh:t,intersecting:!1})}},n.prototype.addIntersectionMeshes=function(e){var t=this;null!=e&&e.forEach(function(e){if(null!=e){var n=t.manager.findSceneCollisionMesh(e);null!=n&&t._intersections.push({mesh:n,intersecting:!1})}})},n.prototype.removeIntersectionMesh=function(e){if(null!=e&&null!=this._intersections&&this._intersections.length>0){var t=this._intersections.length,n=-1,a=0;for(a=0;a<t;a++){var r=this._intersections[a];if(null!=r.mesh&&r.mesh===e){n=a;break}}n>=0&&this._intersections.splice(n,1)}},n.prototype.getIntersectionList=function(){return this._intersections},n.prototype.resetIntersectionList=function(){this._intersections=[]},n.prototype.updateIntersectionList=function(){var t=this;null==this._intersector&&(this._intersector=this.getCollisionMesh()),null!=this._intersector&&null!=this._intersections&&this._intersections.length>0&&this._intersections.forEach(function(n){null!=n.mesh&&(t._intersecting=t._intersector.intersectsMesh(n.mesh,t.intersectionPrecision===e.IntersectionPrecision.OBB),t._intersecting?n.intersecting?null!=t.onIntersectionStay&&t.onIntersectionStay(n.mesh):null!=t.onIntersectionEnter&&t.onIntersectionEnter(n.mesh):n.intersecting&&null!=t.onIntersectionExit&&t.onIntersectionExit(n.mesh),n.intersecting=t._intersecting)})},n.prototype.disposeSceneComponent=function(){if(this.resetIntersectionList(),null!=this.mesh){if(null!=this._mesh.skeleton&&null!=this.mesh.skeleton.bones&&this._mesh.skeleton.bones.length>0&&this.mesh.skeleton.bones.forEach(function(e){null!=e&&null!=e.metadata&&(e.metadata=null)}),null!=this._mesh.physicsImpostor){var e=this._mesh.physicsImpostor;null!=e.onCollideEvent&&(e.onCollideEvent=null)}null!=this._mesh.metadata&&this._mesh.metadata.api&&(this._mesh.metadata.collisionEvent=null)}this._intersector=null,this._mesh=null},n}(e.SceneComponent);e.MeshComponent=r;var i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.start=function(){var e=this;if(e.setupOrthographicCamera){var t=this.getProperty("orthoSize",5),n=this.getProperty("resizeCameras",!0);e.setupOrthographicCamera(t,n)}},t}(e.CameraComponent);e.OrthoController=i;var o=function(){function t(){this.currentVelocity=0}return t.prototype.SmoothDamp=function(t,n,a,r,i){void 0===i&&(i=Number.MAX_VALUE),a=Math.max(1e-4,a);var o=2/a,s=o*r,l=1/(1+s+.48*s*s+.235*s*s*s),u=t-n,c=n,p=i*a;u=e.Scalar.Clamp(u,-p,p),n=t-u;var h=(this.currentVelocity+o*u)*r;this.currentVelocity=(this.currentVelocity-o*h)*l;var d=n+(u+h)*l;return c-t>0==d>c&&(d=c,this.currentVelocity=(d-c)/r),d},t.prototype.SmoothDampAngle=function(t,n,a,r,i){return void 0===i&&(i=Number.MAX_VALUE),n=t+e.Scalar.DeltaAngle(t,n),this.SmoothDamp(t,n,a,i,r)},t}();e.SmoothTool=o;var s=function(){function t(t){this._owned=null,this.slerpIdentity=null,this._owned=t,this.slerpIdentity=e.Quaternion.Identity()}return t.prototype.rotate=function(t,n,a,r){void 0===r&&(r=e.RotateOrder.ZXY);var i=null;return null!=this._owned&&(null==this._owned.rotationQuaternion&&(this._owned.rotationQuaternion=e.Quaternion.RotationYawPitchRoll(this._owned.rotation.y,this._owned.rotation.x,this._owned.rotation.z)),i=r===e.RotateOrder.XYZ?this._owned.addRotation(t,0,0).addRotation(0,n,0).addRotation(0,0,a):r===e.RotateOrder.XZY?this._owned.addRotation(t,0,0).addRotation(0,0,a).addRotation(0,n,0):r===e.RotateOrder.ZXY?this._owned.addRotation(0,0,a).addRotation(t,0,0).addRotation(0,n,0):r===e.RotateOrder.ZYX?this._owned.addRotation(0,0,a).addRotation(0,n,0).addRotation(t,0,0):r===e.RotateOrder.YZX?this._owned.addRotation(0,n,0).addRotation(0,0,a).addRotation(t,0,0):this._owned.addRotation(t,n,a)),i},t.prototype.lookAtPosition=function(t,n,a,r,i,o){void 0===n&&(n=0);var s=null;return null!=this._owned&&(null==this._owned.rotationQuaternion&&(this._owned.rotationQuaternion=e.Quaternion.RotationYawPitchRoll(this._owned.rotation.y,this._owned.rotation.x,this._owned.rotation.z)),null!=this.slerpIdentity&&n>0&&this.slerpIdentity.copyFrom(this._owned.rotationQuaternion),s=this._owned.lookAt(t,a,r,i,o),null!=this.slerpIdentity&&n>0&&e.Quaternion.SlerpToRef(this.slerpIdentity,this._owned.rotationQuaternion,n,this._owned.rotationQuaternion)),s},t.prototype.dispose=function(){this._owned=null,this.slerpIdentity=null},t}();e.MeshRotator=s;var l=function(){function e(e){this._metadata=null,this._metadata=e}return Object.defineProperty(e.prototype,"type",{get:function(){return this._metadata.type},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"prefab",{get:function(){return this._metadata.prefab},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"state",{get:function(){return this._metadata.state},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"objectId",{get:function(){return this._metadata.objectId},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"objectName",{get:function(){return this._metadata.objectName},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tagName",{get:function(){return this._metadata.tagName},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"layerIndex",{get:function(){return this._metadata.layerIndex},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"layerName",{get:function(){return this._metadata.layerName},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"areaIndex",{get:function(){return this._metadata.areaIndex},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"navAgent",{get:function(){return this._metadata.navAgent},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"meshLink",{get:function(){return this._metadata.meshLink},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"meshObstacle",{get:function(){return this._metadata.meshObstacle},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"socketList",{get:function(){return this._metadata.socketList},enumerable:!0,configurable:!0}),e.prototype.setProperty=function(e,t){null!=this._metadata.properties&&(this._metadata.properties[e]=t)},e.prototype.getProperty=function(e,t){void 0===t&&(t=null);var n=null;return null!=this._metadata.properties&&(n=this._metadata.properties[e]),null==n&&(n=t),null!=n?n:null},e}();e.ObjectMetadata=l;var u=function(){function e(){}return e}();e.MachineState=u;var c=function(){function e(){}return e}();e.TransitionCheck=c;var p;!function(e){e[e.YXZ=0]="YXZ",e[e.YZX=1]="YZX",e[e.XYZ=2]="XYZ",e[e.XZY=3]="XZY",e[e.ZXY=4]="ZXY",e[e.ZYX=5]="ZYX"}(p=e.RotateOrder||(e.RotateOrder={}));var h;!function(e){e[e.Clip=0]="Clip",e[e.Tree=1]="Tree"}(h=e.MotionType||(e.MotionType={}));var d;!function(e){e[e.Float=1]="Float",e[e.Int=3]="Int",e[e.Bool=4]="Bool",e[e.Trigger=9]="Trigger"}(d=e.AnimatorParameterType||(e.AnimatorParameterType={}));var m;!function(e){e[e.Deg2Rad=.0174532924]="Deg2Rad",e[e.Rad2Deg=57.29578]="Rad2Deg",e[e.DiagonalSpeed=.7071]="DiagonalSpeed",e[e.MinimumTimeout=.25]="MinimumTimeout"}(m=e.Constants||(e.Constants={}));var f;!function(e){e[e.ExactMatch=0]="ExactMatch",e[e.StartsWith=1]="StartsWith",e[e.EndsWith=2]="EndsWith",e[e.IndexOf=3]="IndexOf"}(f=e.SearchType||(e.SearchType={}));var g;!function(e){e[e.None=-1]="None",e[e.Generic=0]="Generic",e[e.Xbox360=1]="Xbox360"}(g=e.GamepadType||(e.GamepadType={}));var y;!function(e){e[e.Left=0]="Left",e[e.Right=1]="Right"}(y=e.JoystickButton||(e.JoystickButton={}));var _;!function(e){e[e.Left=0]="Left",e[e.Right=1]="Right"}(_=e.Xbox360Trigger||(e.Xbox360Trigger={}));var S;!function(e){e[e.Left=0]="Left",e[e.Middle=1]="Middle",e[e.Right=2]="Right"}(S=e.UserInputPointer||(e.UserInputPointer={}));var v;!function(e){e[e.Horizontal=0]="Horizontal",e[e.Vertical=1]="Vertical",e[e.ClientX=2]="ClientX",e[e.ClientY=3]="ClientY",e[e.MouseX=4]="MouseX",e[e.MouseY=5]="MouseY",e[e.Wheel=6]="Wheel"}(v=e.UserInputAxis||(e.UserInputAxis={}));var M;!function(e){e[e.BackSpace=8]="BackSpace",e[e.Tab=9]="Tab",e[e.Enter=13]="Enter",e[e.Shift=16]="Shift",e[e.Ctrl=17]="Ctrl",e[e.Alt=18]="Alt",e[e.Pause=19]="Pause",e[e.Break=19]="Break",e[e.CapsLock=20]="CapsLock",e[e.Escape=27]="Escape",e[e.SpaceBar=32]="SpaceBar",e[e.PageUp=33]="PageUp",e[e.PageDown=34]="PageDown",e[e.End=35]="End",e[e.Home=36]="Home",e[e.LeftArrow=37]="LeftArrow",e[e.UpArrow=38]="UpArrow",e[e.RightArrow=39]="RightArrow",e[e.DownArrow=40]="DownArrow",e[e.Insert=45]="Insert",e[e.Delete=46]="Delete",e[e.Num0=48]="Num0",e[e.Num1=49]="Num1",e[e.Num2=50]="Num2",e[e.Num3=51]="Num3",e[e.Num4=52]="Num4",e[e.Num5=53]="Num5",e[e.Num6=54]="Num6",e[e.Num7=55]="Num7",e[e.Num8=56]="Num8",e[e.Num9=57]="Num9",e[e.A=65]="A",e[e.B=66]="B",e[e.C=67]="C",e[e.D=68]="D",e[e.E=69]="E",e[e.F=70]="F",e[e.G=71]="G",e[e.H=72]="H",e[e.I=73]="I",e[e.J=74]="J",e[e.K=75]="K",e[e.L=76]="L",e[e.M=77]="M",e[e.N=78]="N",e[e.O=79]="O",e[e.P=80]="P",e[e.Q=81]="Q",e[e.R=82]="R",e[e.S=83]="S",e[e.T=84]="T",e[e.U=85]="U",e[e.V=86]="V",e[e.W=87]="W",e[e.X=88]="X",e[e.Y=89]="Y",e[e.Z=90]="Z",e[e.LeftWindowKey=91]="LeftWindowKey",e[e.RightWindowKey=92]="RightWindowKey",e[e.SelectKey=93]="SelectKey",e[e.Numpad0=96]="Numpad0",e[e.Numpad1=97]="Numpad1",e[e.Numpad2=98]="Numpad2",e[e.Numpad3=99]="Numpad3",e[e.Numpad4=100]="Numpad4",e[e.Numpad5=101]="Numpad5",e[e.Numpad6=102]="Numpad6",e[e.Numpad7=103]="Numpad7",e[e.Numpad8=104]="Numpad8",e[e.Numpad9=105]="Numpad9",e[e.Multiply=106]="Multiply",e[e.Add=107]="Add",e[e.Subtract=109]="Subtract",e[e.DecimalPoint=110]="DecimalPoint",e[e.Divide=111]="Divide",e[e.F1=112]="F1",e[e.F2=113]="F2",e[e.F3=114]="F3",e[e.F4=115]="F4",e[e.F5=116]="F5",e[e.F6=117]="F6",e[e.F7=118]="F7",e[e.F8=119]="F8",e[e.F9=120]="F9",e[e.F10=121]="F10",e[e.F11=122]="F11",e[e.F12=123]="F12",e[e.NumLock=144]="NumLock",e[e.ScrollLock=145]="ScrollLock",e[e.SemiColon=186]="SemiColon",e[e.EqualSign=187]="EqualSign",e[e.Comma=188]="Comma",e[e.Dash=189]="Dash",e[e.Period=190]="Period",e[e.ForwardSlash=191]="ForwardSlash",e[e.GraveAccent=192]="GraveAccent",e[e.OpenBracket=219]="OpenBracket",e[e.BackSlash=220]="BackSlash",e[e.CloseBraket=221]="CloseBraket",e[e.SingleQuote=222]="SingleQuote"}(M=e.UserInputKey||(e.UserInputKey={}));var b;!function(e){e[e.DirectVelocity=0]="DirectVelocity",e[e.AppliedForces=1]="AppliedForces"}(b=e.MovementType||(e.MovementType={}));var k;!function(e){e[e.Top=0]="Top",e[e.Left=1]="Left",e[e.Right=2]="Right",e[e.Bottom=3]="Bottom"}(k=e.CollisionContact||(e.CollisionContact={}));var x;!function(e){e[e.AABB=0]="AABB",e[e.OBB=1]="OBB"}(x=e.IntersectionPrecision||(e.IntersectionPrecision={}));var w;!function(e){e[e.If=1]="If",e[e.IfNot=2]="IfNot",e[e.Greater=3]="Greater",e[e.Less=4]="Less",e[e.Equals=6]="Equals",e[e.NotEqual=7]="NotEqual"}(w=e.ConditionMode||(e.ConditionMode={}));var P;!function(e){e[e.None=0]="None",e[e.Source=1]="Source",e[e.Destination=2]="Destination",e[e.SourceThenDestination=3]="SourceThenDestination",e[e.DestinationThenSource=4]="DestinationThenSource"}(P=e.InterruptionSource||(e.InterruptionSource={}));var T;!function(e){e[e.Simple1D=0]="Simple1D",e[e.SimpleDirectional2D=1]="SimpleDirectional2D",e[e.FreeformDirectional2D=2]="FreeformDirectional2D",e[e.FreeformCartesian2D=3]="FreeformCartesian2D",e[e.Direct=4]="Direct"}(T=e.BlendTreeType||(e.BlendTreeType={}));var I=function(){function e(){}return e.JoystickRightHandleColor="yellow",e.JoystickLeftSensibility=1,e.JoystickRightSensibility=1,e.JoystickDeadStickValue=.1,e.GamepadDeadStickValue=.25,e.GamepadLStickXInverted=!1,e.GamepadLStickYInverted=!1,e.GamepadRStickXInverted=!1,e.GamepadRStickYInverted=!1,e.GamepadLStickSensibility=1,e.GamepadRStickSensibility=1,e.PointerAngularSensibility=1,e.PointerWheelDeadZone=.1,e}();e.UserInputOptions=I}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(t,n){if(this.onrender=null,this._ie=!1,this._url="",this._time=0,this._timing=!1,this._filename=null,this._render=null,this._running=!1,this._markup="",this._gui="None",this._input=!1,this._scene=null,this._navmesh=null,this._navigation=null,this._mainCamera=null,this._loadQueueIndex=0,this._loadQueueCount=0,this._loadQueueScenes=null,this._localReadyState=null,this._localSceneReady=!1,this.updateCamera=null,this.updateCameraInput=!1,this.cameraInputMoveSpeed=1,this.cameraInputRotateSpeed=.005,this._onready=[],null==n)throw new Error("Null host scene obejct specified.");this._ie=!!document.all,this._url=t,this._time=0,this._timing=!1,this._filename=null,this._scene=n,this._input=!1,this._onready=[],this._navmesh=null,this._navigation=null,this._mainCamera=null,this._loadQueueIndex=0,this._loadQueueCount=0,this._loadQueueScenes=null,this._localSceneReady=!1,this._localReadyState={state:"localReadyState"},this._scene._addPendingData(this._localReadyState),e.SceneManager.me=this,e.SceneManager.engine=this._scene.getEngine(),e.SceneManager.prefabs={},e.SceneManager.orphans=null,e.SceneManager.rightHanded=this._scene.useRightHandedSystem,e.SceneManager.staticVertexLimit=!1,e.SceneManager.showDebugSockets=!1,e.SceneManager.colliderVisibility=.25,e.SceneManager.socketColliderSize=.125,this.updateCamera=null,this.updateCameraInput=!1,this.cameraInputMoveSpeed=1,this.cameraInputRotateSpeed=.005,null!=this._scene.metadata&&null!=this._scene.metadata.properties&&(this._scene.metadata.properties.colliderVisibility&&null!=this._scene.metadata.properties.colliderVisibility&&(e.SceneManager.colliderVisibility=this._scene.metadata.properties.colliderVisibility),this._scene.metadata.properties.socketColliderSize&&null!=this._scene.metadata.properties.socketColliderSize&&(e.SceneManager.socketColliderSize=this._scene.metadata.properties.socketColliderSize),this._scene.metadata.properties.hasOwnProperty("showDebugSockets")&&(e.SceneManager.showDebugSockets=this._scene.metadata.properties.showDebugSockets),this._scene.metadata.properties.hasOwnProperty("staticVertexLimit")&&(e.SceneManager.staticVertexLimit=this._scene.metadata.properties.staticVertexLimit));var a=[];if(e.SceneManager.parseSceneCameras(this._scene.cameras,this._scene,a),e.SceneManager.parseSceneLights(this._scene.lights,this._scene,a),e.SceneManager.parseSceneMeshes(this._scene.meshes,this._scene,a),null!=this._scene.metadata&&null!=this._scene.metadata.properties&&null!=this._scene.metadata.properties.interfaceMode&&(this._gui=this._scene.metadata.properties.interfaceMode,null!=this._scene.metadata.properties.userInterface)){var r=this._scene.metadata.properties.userInterface;window&&r.embedded&&null!=r.base64&&(this._markup=window.atob(r.base64),this._scene.metadata.properties.autoDraw===!0&&null!=this._gui&&""!==this._gui&&"None"!==this._gui&&null!=this._markup&&""!==this._markup&&this.drawSceneMarkup(this._markup))}a.length>0&&(a.sort(function(e,t){return e.order<t.order?-1:e.order>t.order?1:0}),a.forEach(function(e){e.instance.register()}));var i=this;this._render=function(){null!=i&&(i._timing&&null!=e.SceneManager.engine&&(i._time+=i.deltaTime,i._time>=e.SceneManager.max&&(i._time=0)),i._input&&e.SceneManager.updateUserInput(),null!=i._scene&&i._scene.render(),null!=i.onrender&&i.onrender())},this._scene.onDispose=function(){null!=i&&i.dispose()}}return t.GetInstance=function(){return e.SceneManager.me},t.CreateScene=function(t){var n=new e.Scene(t);return e.SceneManager.parseSceneMetadata("/",n),n},t.RegisterLoader=function(t){e.SceneManager.loader=t},t.ExecuteWhenReady=function(t){null!=t&&e.SceneManager.readies.push(t)},t.CreateManagerSession=function(t,n){var a=n;return null!=a.manager&&(a.manager.dispose(),a.manager=null),a.manager=new e.SceneManager(t,n),null!=a.manager&&a.manager._executeWhenReady(),a.manager},Object.defineProperty(t,"StaticIndex",{get:function(){return 30},enumerable:!0,configurable:!0}),Object.defineProperty(t,"PrefabIndex",{get:function(){return 31},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ie",{get:function(){return this._ie},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"url",{get:function(){return this._url},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"time",{get:function(){return this._time},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"deltaTime",{get:function(){return e.SceneManager.engine.getDeltaTime()/1e3},enumerable:!0,configurable:!0}),t.prototype.getScene=function(){return this._scene},t.prototype.dispose=function(){e.SceneManager.me=null,e.SceneManager.engine=null,e.SceneManager.prefabs=null,e.SceneManager.orphans=null,e.SceneManager.rightHanded=!0,null!=e.SceneManager.orphans&&(e.SceneManager.orphans.dispose(),e.SceneManager.orphans=null),this.disableUserInput(),this._gui=null,this._time=0,this._render=null,this._markup=null,this._navmesh=null,this._timing=!1,this._navigation=null,this._onready=null,this.onrender=null,this.updateCamera=null,this.updateCameraInput=!1,this.cameraInputMoveSpeed=1,this.cameraInputRotateSpeed=.005;var t=this._scene;t.manager&&(t.manager=null),t=null,this._scene=null},t.prototype.once=function(e){var t=this;if(null!=e){var n=!1,a=null;a=function(){t._scene.unregisterBeforeRender(a),a=null,n===!1&&(n=!0,e())},this._scene.registerBeforeRender(a)}},t.prototype.delay=function(e,t){return window.setTimeout(e,t)},t.prototype.repeat=function(e,t){return window.setInterval(e,t)},t.prototype.clear=function(e){window.clearInterval(e)},t.prototype.enableTime=function(){this._time=0,this._timing=!0},t.prototype.disableTime=function(){this._time=0,this._timing=!1},t.prototype.loadLevel=function(t,n){if(void 0===n&&(n=null),null==e.SceneManager.loader)throw new Error("No scene loader function registered.");var a=null!=n&&""!==n?n:this.getScenePath();this.stop(),this.clearSceneMarkup(),this._scene.dispose(),e.SceneManager.loader(a,t)},t.prototype.importMeshes=function(t,n,a,r){void 0===n&&(n=null),void 0===a&&(a=null),void 0===r&&(r=null),e.SceneLoader.ImportMesh("",this.getScenePath(),t,this._scene,function(e,t,a){null!=n&&n()},a,r)},t.prototype.safeDestroy=function(e,t,n){void 0===t&&(t=5),void 0===n&&(n=!1),n&&e.setEnabled(!1),this.delay(function(){e.dispose()},t)},t.prototype.getSceneName=function(){if((null==this._filename||""===this._filename)&&null!=this._scene.database&&null!=this._scene.database.currentSceneUrl){var e=this._scene.database.currentSceneUrl,t=e.length,n=e.lastIndexOf("/");n<0?n=0:n++,this._filename=e.substr(n,t)}return null!=this._filename&&""!==this._filename?this._filename:"Unknown.babylon"},t.prototype.getScenePath=function(){if((null==this._url||""===this._url)&&null!=this._scene.database&&null!=this._scene.database.currentSceneUrl){var e=this._scene.database.currentSceneUrl;this._url=e.substr(0,e.lastIndexOf("/"))+"/"}return null!=this._url&&""!==this._url?this._url:"/"},t.prototype.getMainCamera=function(){if(null==this._mainCamera){var e=this._scene.getCamerasByTags("MainCamera");null!=e&&e.length>0&&(this._mainCamera=e[0])}return this._mainCamera},t.prototype.showFullscreen=function(t){void 0===t&&(t=null);var n=null!=t?t:document.documentElement;e.Tools.RequestFullscreen(n),n.focus()},t.prototype.exitFullscreen=function(){e.Tools.ExitFullscreen()},t.prototype.showLoadingScreen=function(t,n,a){void 0===t&&(t="Babylon Toolkit"),void 0===n&&(n=null),void 0===a&&(a=!0);var r=window;r.showSceneLoader?r.showSceneLoader(t):(e.SceneManager.engine.loadingUIText=t,e.SceneManager.engine.displayLoadingUI(),a===!0&&(e.SceneLoader.ShowLoadingScreen=!1)),null!=n&&this.updateLoadingStatus(n)},t.prototype.freezeLoadingScreen=function(e,t,n){void 0===e&&(e="Babylon Toolkit"),void 0===t&&(t=null),void 0===n&&(n=!0),window.show=!1,this.showLoadingScreen(e,t,n)},t.prototype.hideLoadingScreen=function(t){void 0===t&&(t=!0);var n=window;n.removeSceneLoader?n.removeSceneLoader():(e.SceneManager.engine.hideLoadingUI(),t===!0&&(e.SceneLoader.ShowLoadingScreen=!0))},t.prototype.updateLoadingStatus=function(e){var t=window;t.updateStatus&&t.updateStatus(e)},t.prototype.isRunning=function(){return this._running},t.prototype.isMobile=function(){var t=!1;if(null!=navigator&&null!=navigator.userAgent){var n=navigator.userAgent;(n.match(/Android/i)||n.match(/webOS/i)||n.match(/iPhone/i)||n.match(/iPad/i)||n.match(/iPod/i)||n.match(/BlackBerry/i)||n.match(/Windows Phone/i))&&(t=!0)}else e.Tools.Warn("Host navigator user agent is unavailable.");return t},t.prototype.onready=function(e){null!=e&&(this._localSceneReady===!0?e():this._onready.push(e))},t.prototype._executeWhenReady=function(){null!=this._scene.metadata&&null!=this._scene.metadata.imports?(this._loadQueueIndex=0,this._loadQueueScenes=this._scene.metadata.imports,this._loadQueueScenes.length>0?(this._loadQueueCount=this._loadQueueScenes.length,this._loadQueueImports()):this._executeLocalReady()):this._executeLocalReady()},t.prototype._executeLocalReady=function(){var t=this;if(null!=e.SceneManager.readies&&e.SceneManager.readies.length>0&&e.SceneManager.readies.forEach(function(e){e(t._scene,t)}),e.SceneManager.readies=[],null!=this._onready&&this._onready.length>0&&(this._onready.forEach(function(e){e()}),this._onready=null),this._localSceneReady=!0,null!=this._scene.metadata&&null!=this._scene.metadata.properties&&(this._scene.metadata.properties.timeManagement===!0&&this.enableTime(),this._scene.metadata.properties.enableUserInput===!0)){var n=this._scene.metadata.properties.userInput,a=n.joystickInputValue;0!==a&&this._scene.metadata.properties.virtualJoystickAttached===!0&&(a=0,e.Tools.Warn("Virtual joystick camera attached, disabled manual joystick input.")),this.enableUserInput({preventDefault:this._scene.metadata.properties.preventDefault,useCapture:this._scene.metadata.properties.useCapture,enableVirtualJoystick:1===a||2===a&&this.isMobile(),disableRightStick:n.disableRightStick});var r=n.joystickRightColorText;null!=r&&""!==r&&(e.UserInputOptions.JoystickRightHandleColor=r),e.UserInputOptions.JoystickLeftSensibility=n.joystickLeftLevel,e.UserInputOptions.JoystickRightSensibility=n.joystickRightLevel,e.UserInputOptions.JoystickDeadStickValue=n.joystickDeadStick,e.UserInputOptions.GamepadDeadStickValue=n.padDeadStick,e.UserInputOptions.GamepadLStickXInverted=n.padLStickXInvert,e.UserInputOptions.GamepadLStickYInverted=n.padLStickYInvert,e.UserInputOptions.GamepadRStickXInverted=n.padRStickXInvert,e.UserInputOptions.GamepadRStickYInverted=n.padRStickYInvert,e.UserInputOptions.GamepadLStickSensibility=n.padLStickLevel,e.UserInputOptions.GamepadRStickSensibility=n.padRStickLevel,e.UserInputOptions.PointerAngularSensibility=n.mouseAngularLevel,e.UserInputOptions.PointerWheelDeadZone=n.wheelDeadZone}null!=this._localReadyState&&(this._scene._removePendingData(this._localReadyState),this._localReadyState=null)},t.prototype._loadQueueImports=function(){var t=this,n=this._loadQueueIndex+1;if(n>this._loadQueueCount)this._loadQueueIndex=0,this._loadQueueCount=0,this._loadQueueScenes=null,this._executeLocalReady();else{var a=this._loadQueueScenes[this._loadQueueIndex];e.Tools.Log("Importing scene meshes: "+a),this._loadQueueIndex++,this.importMeshes(a,function(){t._loadQueueImports()},null,function(n,a,r){e.Tools.Warn(a),t._loadQueueImports()})}},t.prototype.start=function(){this._running=!0,this._scene.getEngine().runRenderLoop(this._render)},t.prototype.stop=function(){this._running=!1,this._scene.getEngine().stopRenderLoop(this._render)},t.prototype.toggle=function(){this._running?(this.pauseAudio(),this.stop()):(this.resumeAudio(),this.start())},t.prototype.stepFrame=function(){this._running?this.toggle():this._render()},t.prototype.pauseAudio=function(){this._scene.audioEnabled===!0&&(this._scene.audioEnabled=!1)},t.prototype.resumeAudio=function(){this._scene.audioEnabled===!1&&(this._scene.audioEnabled=!0)},t.prototype.toggleDebug=function(e,t,n){void 0===e&&(e=!1),void 0===t&&(t=0),void 0===n&&(n=null),this._scene.debugLayer.isVisible()?this._scene.debugLayer.hide():this._scene.debugLayer.show({popup:e,initialTab:t,parentElement:n})},t.prototype.getGuiMode=function(){return this._gui},t.prototype.getGuiElement=function(){return document.getElementById("gui")},t.prototype.getSceneMarkup=function(){return this._markup},t.prototype.drawSceneMarkup=function(t){if("Html"===this._gui){var n=document.getElementById("gui");if(null==n){var a=document.createElement("div");a.id="gui",a.style.width="100%",a.style.height="100%",a.style.opacity="1",a.style.zIndex="10",a.style.outline="none",a.style.backgroundColor="transparent",document.body.appendChild(a),a.innerHTML=t}else n.innerHTML=t}else e.Tools.Warn("Scene gui markup disabled.")},t.prototype.clearSceneMarkup=function(){if("Html"===this._gui){var t=document.getElementById("gui");
null!=t&&(t.innerHTML="")}else e.Tools.Warn("Scene gui markup disabled.")},t.prototype.rayCast=function(e,t,n){return this._scene.pickWithRay(e,t,n)},t.prototype.multiRayCast=function(e,t){return this._scene.multiPickWithRay(e,t)},t.prototype.getMaterialInstance=function(e,t){void 0===t&&(t=null);var n=this._scene.getMaterialByName(e);return null==n&&null!=t&&(n=t(e)),null!=n?n:null},t.prototype.hasPrefabMesh=function(t){var n="Prefab."+t;return null!=e.SceneManager.prefabs[n]},t.prototype.getPrefabMesh=function(t){var n=null,a="Prefab."+t;return this.hasPrefabMesh(t)&&(n=e.SceneManager.prefabs[a]),n},t.prototype.instantiatePrefab=function(t,n,a,r,i,o){var s=this;void 0===a&&(a=null),void 0===r&&(r=null),void 0===i&&(i=null),void 0===o&&(o=null);var l=null,u="Prefab."+t;if(this.hasPrefabMesh(t)){var c=this.getPrefabMesh(t);if(null!=c)if(l=c.clone(n,o,!1,!1),null!=l){l.name=e.Utilities.ReplaceAll(l.name,"Prefab.",""),l.parent!==o&&(l.parent=o),null!=a&&(l.position=a),null!=r&&(l.rotation=r),null!=i&&(l.scaling=i);var p=[l],h=l.getChildMeshes(!1);null!=h&&h.length>0&&h.forEach(function(t){t.name=e.Utilities.ReplaceAll(t.name,"Prefab.",""),p.push(t)}),p.forEach(function(e){if(null!=e.source){var t=e;if(null==e.skeleton&&null!=e.source.skeleton){var n=e.source.skeleton.name+".Skeleton",a=n+"."+e.source.skeleton.id;e.skeleton=e.source.skeleton.clone(n,a)}if((null==t._LODLevels||t._LODLevels.length<=0)&&null!=t.source&&null!=t.source._LODLevels&&t.source._LODLevels.length>0){var r=t.source._LODLevels,i=r.length,o=0,s=[];for(o=0;o<i;o++){var l=r[o],u=l.mesh,c=null!=u?u.clone(u.name.replace("Prefab.",""),e,!1,!1):null;s.push({distance:l.distance,mesh:c})}null!=s&&s.length>0&&s.forEach(function(t){e.addLODLevel(t.distance,t.mesh)})}}});var d=[];p.forEach(function(t){if(null!=t.metadata&&t.metadata.tagName&&null!=t.metadata.tagName&&"[INSTANCE]"===t.metadata.tagName)if(t.metadata.properties&&null!=t.metadata.properties&&t.metadata.properties.prefabSource&&null!=t.metadata.properties.prefabSource&&""!==t.metadata.properties.prefabSource){var n=t.metadata.properties.prefabSource,a=t.metadata.properties.prefabOffset,r=t.metadata.properties.prefabPosition,i=s._scene.getMeshByID(n);if(null!=i){var o=t.name,l=i.createInstance(o);null!=l?(l.parent=t.parent,null!=i.metadata&&(l.metadata=e.SceneManager.CloneMetadata(i.metadata)),a===!0&&null!=r&&r.length>=3&&(l.position=new e.Vector3(r[0],r[1],r[2])),d.push(l),s.safeDestroy(t)):e.Tools.Warn("===> Failed to create instance: "+o)}else e.Tools.Warn("===> Failed to locate prefab source: "+n)}else e.Tools.Warn("===> Failed to parse prefab metadata: "+t.name);else d.push(t)}),null!=d&&d.length>0&&e.SceneManager.parseMeshMetadata(d,this._scene)}else e.Tools.Warn("Failed to create prefab of: "+u);else e.Tools.Warn("Failed to lookup prefab map: "+u)}else e.Tools.Warn("Unable to locate prefab master: "+u);return l},t.prototype.tween=function(t,n,a,r,i,o,s,l,u,c,p){void 0===o&&(o=30),void 0===s&&(s=null),void 0===l&&(l=1),void 0===u&&(u=null),void 0===c&&(c=e.Animation.ANIMATIONLOOPMODE_RELATIVE),void 0===p&&(p=!1);var h="Tween_"+this.time.toString();return e.Animation.CreateAndStartAnimation(h,t,n,o,i,a,r,c,s,u)},t.prototype.tweenKeys=function(t,n,a,r,i,o,s,l,u,c,p){void 0===i&&(i=30),void 0===o&&(o=null),void 0===s&&(s=1),void 0===l&&(l=null),void 0===u&&(u=e.Animation.ANIMATIONTYPE_VECTOR3),void 0===c&&(c=e.Animation.ANIMATIONLOOPMODE_RELATIVE),void 0===p&&(p=!1);var h=null!=i&&i>0?i:30,d="Tween_"+this.time.toString(),m=new e.Animation(d,n,h,u,c,p);return null!=o&&m.setEasingFunction(o),m.setKeys(a),this._scene.beginDirectAnimation(t,[m],0,r,c==e.Animation.ANIMATIONLOOPMODE_RELATIVE,s,l)},t.prototype.tweenFloat=function(t,n,a,r,i,o,s,l,u,c,p){void 0===o&&(o=30),void 0===s&&(s=null),void 0===l&&(l=1),void 0===u&&(u=null),void 0===c&&(c=e.Animation.ANIMATIONLOOPMODE_RELATIVE),void 0===p&&(p=!1);var h=null!=o&&o>0?o:30,d=[{frame:0,value:a},{frame:i,value:r}],m="Tween_"+this.time.toString(),f=e.Animation.ANIMATIONTYPE_FLOAT,g=new e.Animation(m,n,h,f,c,p);return null!=s&&g.setEasingFunction(s),g.setKeys(d),this._scene.beginDirectAnimation(t,[g],0,i,c==e.Animation.ANIMATIONLOOPMODE_RELATIVE,l,u)},t.prototype.playAnimationClip=function(e,t,n,a,r,i){void 0===n&&(n=0),void 0===a&&(a=0),void 0===r&&(r=!0),void 0===i&&(i=null);var o=null,s=a>0?a:1,l=-1,u=-1,c=0,p=!1,h=!1,d=null,m=this.findSceneAnimationClip(e,t);if(null!=m&&(h=!0,d=i,l===-1&&(l=m.start,u=m.stop,c=m.behavior,p=m.behavior<2,s=a>0?a:m.playback)),r){var f=t.getChildMeshes(!1);if(null!=f&&f.length>0)for(var g=0;g<f.length;g++){var y=f[g],_=null,S=this.findSceneAnimationClip(e,y);if(null!=S&&(h===!1&&(h=!0,_=i),l===-1&&(l=S.start,u=S.stop,c=S.behavior,p=S.behavior<2,s=a>0?a:S.playback),l>=0&&u>=0)){this.setupAnimationProperties(y,c,n);var v=this._scene.beginAnimation(y,l,u,p,s,_);null!=v&&(null==o&&(o=[]),o.push(v))}}}if(l>=0&&u>=0){this.setupAnimationProperties(t,c,n);var M=this._scene.beginAnimation(t,l,u,p,s,d);null!=M&&(null==o&&(o=[]),o.push(M))}return o},t.prototype.setupAnimationProperties=function(t,n,a){if(null!=t&&(null!=t.animations&&t.animations.length>0&&e.SceneManager.SetAnimationLooping(t,n),t instanceof e.AbstractMesh)){var r=t;null!=r.skeleton&&null!=r.skeleton.bones&&r.skeleton.bones.length>0&&e.SceneManager.SetSkeletonProperties(r.skeleton,n,a)}},t.prototype.applyForce=function(t,n,a){null!=t&&(null!=t.physicsImpostor?null!=n&&t.physicsImpostor.applyForce(n,a):e.Tools.Warn("Physics imposter not defined for mesh: "+t.name))},t.prototype.applyImpulse=function(t,n,a){null!=t&&(null!=t.physicsImpostor?null!=n&&t.physicsImpostor.applyImpulse(n,a):e.Tools.Warn("Physics imposter not defined for mesh: "+t.name))},t.prototype.applyFriction=function(t,n){null!=t&&(null!=t.physicsImpostor&&null!=t.physicsImpostor.physicsBody&&null!=t.physicsImpostor.physicsBody.material?t.physicsImpostor.physicsBody.material.friction=n:e.Tools.Warn("Physics imposter not defined for mesh: "+t.name))},t.prototype.getFrictionLevel=function(t){var n=0;return null!=t&&(null!=t.physicsImpostor&&null!=t.physicsImpostor.physicsBody&&null!=t.physicsImpostor.physicsBody.material?n=t.physicsImpostor.physicsBody.material.friction:e.Tools.Warn("Physics imposter not defined for mesh: "+t.name)),n},t.prototype.getLinearVelocity=function(t){var n=null;return null!=t&&(null!=t.physicsImpostor?n=t.physicsImpostor.getLinearVelocity():e.Tools.Warn("Physics imposter not defined for mesh: "+t.name)),n},t.prototype.setLinearVelocity=function(t,n){null!=t&&(null!=t.physicsImpostor?null!=n&&t.physicsImpostor.setLinearVelocity(n):e.Tools.Warn("Physics imposter not defined for mesh: "+t.name))},t.prototype.getAngularVelocity=function(t){var n=null;return null!=t&&(null!=t.physicsImpostor?n=t.physicsImpostor.getAngularVelocity():e.Tools.Warn("Physics imposter not defined for mesh: "+t.name)),n},t.prototype.setAngularVelocity=function(t,n){null!=t&&(null!=t.physicsImpostor?null!=n&&t.physicsImpostor.setAngularVelocity(n):e.Tools.Warn("Physics imposter not defined for mesh: "+t.name))},t.prototype.checkCollisionContact=function(t,n,a,r){void 0===r&&(r=.5);var i=!1;return null!=t&&(null!=t.physicsImpostor?i=!0:e.Tools.Warn("Physics imposter not defined for mesh: "+t.name)),i},t.prototype.moveWithCollisions=function(t,n,a){void 0===a&&(a=0),null!=t&&(0!=a&&t.rotate(e.Axis.Y,a),null!=n&&t.moveWithCollisions(n))},t.prototype.moveWithTranslation=function(t,n,a){void 0===a&&(a=0),null!=t&&(0!=a&&t.rotate(e.Axis.Y,a),null!=n&&t.position.addInPlace(n))},t.prototype.addSceneComponent=function(t,n,a,r){void 0===a&&(a=!0),void 0===r&&(r={});var i=null;if(null==n)throw new Error("Null owner scene obejct specified.");if(null==t||""===t)throw new Error("Null scene obejct klass specified.");if(null==n.metadata||!n.metadata.api){var o={api:!0,type:"Babylon",prefab:!1,state:{},objectName:"Scene Component",objectId:"0",tagName:"Untagged",layerIndex:0,layerName:"Default",areaIndex:-1,navAgent:null,meshLink:null,meshObstacle:null,socketList:[],animationClips:[],animationEvents:[],collisionEvent:null,components:[],properties:{}};n.metadata=o}if(null!=n.metadata&&n.metadata.api){null!=n.metadata.disposal&&n.metadata.disposal!==!1||(n.onDispose=function(){e.SceneManager.DestroyComponents(n)},n.metadata.disposal=!0);var o=n.metadata;if(null==o.components&&(o.components=[]),null!=o.components){var s=e.Tools.Instantiate(t);if(null!=s)if(i=new s(n,this._scene,a,r),null!=i){var l={order:1e3,name:"EditorScriptComponent",klass:t,update:a,properties:r,instance:i,tag:{}};o.components.push(l),i.register()}else e.Tools.Error("Failed to create component instance");else e.Tools.Error("Failed to create component class")}else e.Tools.Error("Failed to parse metadata components")}else e.Tools.Error("Null owner object metadata");return i},t.prototype.findSceneComponent=function(e,t){var n=null;if(null==t)throw new Error("Null owner scene obejct specified.");if(null!=t.metadata&&t.metadata.api){var a=t.metadata;if(null!=a.components&&a.components.length>0)for(var r=0;r<a.components.length;r++){var i=a.components[r];if(null!=i.instance&&i.klass===e){n=i.instance;break}}}return null!=n?n:null},t.prototype.findSceneComponents=function(e,t){var n=null;if(null==t)throw new Error("Null owner scene obejct specified.");if(null!=t.metadata&&t.metadata.api){var a=t.metadata;if(null!=a.components&&a.components.length>0)for(var r=0;r<a.components.length;r++){var i=a.components[r];null!=i.instance&&i.klass===e&&n.push(i.instance)}}return null!=n?n:null},t.prototype.findSceneMetadata=function(t){var n=null;if(null!=t.metadata&&t.metadata.api){var a=t.metadata;n=new e.ObjectMetadata(a)}return n},t.prototype.findSceneChildMesh=function(t,n,a,r,i){void 0===a&&(a=e.SearchType.StartsWith),void 0===r&&(r=!0),void 0===i&&(i=null);var o=(null!=a?a:e.SearchType.StartsWith,n.getChildMeshes(r,i));return e.SceneManager.FindMesh(t,o,a)},t.prototype.findSceneCollisionMesh=function(e,t,n){void 0===t&&(t=!0),void 0===n&&(n=null);var a=null,r=e.getChildMeshes(t,n);if(null!=r&&r.length>0)for(var i=0;i<r.length;i++){var o=r[i];if("Collider"===o.name||o.name.indexOf("_Collider")>=0||o.name.indexOf(":Collider")>=0){a=o;break}}return null==a&&(a=e),a},t.prototype.findSceneSkeleton=function(e){var t=null,n=null!=this._scene.skeletons?this._scene.skeletons.length:0;if(n>0){var a=0;for(a=0;a<n;a++){var r=this._scene.skeletons[a],i=""+r.id;if(i===e){t=r;break}}}return t},t.prototype.findSceneSocketMesh=function(t,n,a,r){void 0===a&&(a=!0),void 0===r&&(r=null);var i=e.SceneManager.locateOwnerSocketMesh(t,n);if(null==i){var o=n.getChildMeshes(a,r);if(null!=o&&o.length>0)for(var s=0;s<o.length;s++){var l=o[s];if(i=e.SceneManager.locateOwnerSocketMesh(t,l),null!=i)break}}return i},t.prototype.findSceneSocketMeshes=function(t,n,a){void 0===n&&(n=!0),void 0===a&&(a=null);var r=e.SceneManager.locateOwnerSocketMeshes(t);if(null==r){var i=t.getChildMeshes(n,a);if(null!=i&&i.length>0)for(var o=0;o<i.length;o++){var s=i[o];if(r=e.SceneManager.locateOwnerSocketMeshes(s),null!=r)break}}return r},t.prototype.findSceneAnimationClip=function(e,t){var n=null;if(null!=t&&null!=t.metadata&&t.metadata.api){var a=t.metadata;if(null!=a.animationClips&&a.animationClips.length>0)if(null!=e&&""!==e){var r=0;for(r=0;r<a.animationClips.length;r++)if(a.animationClips[r].name===e){n=a.animationClips[r];break}}else n=a.animationClips[0]}return n},t.prototype.findSceneAnimationClips=function(e){var t=null;if(null!=e&&null!=e.metadata&&e.metadata.api){var n=e.metadata;null!=n.animationClips&&n.animationClips.length>0&&(t=n.animationClips)}return t},t.prototype.findSceneParticleSystem=function(e,t){var n=null;if(null==t)throw new Error("Null owner scene obejct specified.");if(null!=this._scene.particleSystems&&this._scene.particleSystems.length>0)for(var a=this._scene.particleSystems.length,r=0;r<a;r++){var i=this._scene.particleSystems[r];if(i.emitter===t&&i.name===e){n=i;break}}return n},t.prototype.findSceneParticleSystems=function(e){var t=[];if(null==e)throw new Error("Null owner scene obejct specified.");return null!=this._scene.particleSystems&&this._scene.particleSystems.length>0&&this._scene.particleSystems.forEach(function(n){n.emitter===e&&t.push(n)}),t},t.prototype.findSceneLensFlareSystem=function(e,t){var n=null;if(null==t)throw new Error("Null owner scene obejct specified.");if(null!=this._scene.lensFlareSystems&&this._scene.lensFlareSystems.length>0)for(var a=this._scene.lensFlareSystems.length,r=0;r<a;r++){var i=this._scene.lensFlareSystems[r];if(i.getEmitter()===t&&i.name===e){n=i;break}}return n},t.prototype.findSceneLensFlareSystems=function(e){var t=[];if(null==e)throw new Error("Null owner scene obejct specified.");return null!=this._scene.lensFlareSystems&&this._scene.lensFlareSystems.length>0&&this._scene.lensFlareSystems.forEach(function(n){n.getEmitter()===e&&t.push(n)}),t},t.prototype.resetUserInput=function(){e.SceneManager.keymap={},e.SceneManager.wheel=0,e.SceneManager.clientx=0,e.SceneManager.clienty=0,e.SceneManager.mousex=0,e.SceneManager.mousey=0,e.SceneManager.vertical=0,e.SceneManager.horizontal=0,e.SceneManager.x_wheel=0,e.SceneManager.x_mousex=0,e.SceneManager.x_mousey=0,e.SceneManager.x_vertical=0,e.SceneManager.x_horizontal=0,e.SceneManager.k_mousex=0,e.SceneManager.k_mousey=0,e.SceneManager.k_vertical=0,e.SceneManager.k_horizontal=0,e.SceneManager.j_mousex=0,e.SceneManager.j_mousey=0,e.SceneManager.j_vertical=0,e.SceneManager.j_horizontal=0,e.SceneManager.g_mousex=0,e.SceneManager.g_mousey=0,e.SceneManager.g_vertical=0,e.SceneManager.g_horizontal=0,e.SceneManager.preventDefault=!1,e.SceneManager.gamepadButtonUp=[],e.SceneManager.gamepadButtonDown=[],e.SceneManager.gamepadButtonPress=[],e.SceneManager.gamepadDpadUp=[],e.SceneManager.gamepadDpadDown=[],e.SceneManager.gamepadDpadPress=[],e.SceneManager.gamepadLeftTrigger=[],e.SceneManager.gamepadRightTrigger=[],e.SceneManager.mouseButtonUp=[],e.SceneManager.mouseButtonDown=[],e.SceneManager.mouseButtonPress=[],e.SceneManager.keyButtonUp=[],e.SceneManager.keyButtonDown=[],e.SceneManager.keyButtonPress=[]},t.prototype.enableUserInput=function(t){void 0===t&&(t=null);var n=!(null==t||!t.preventDefault)&&t.preventDefault,a=!(null==t||!t.useCapture)&&t.useCapture,r=!(null==t||!t.enableVirtualJoystick)&&t.enableVirtualJoystick,i=!(null==t||!t.disableRightStick)&&t.disableRightStick,o=null!=t&&t.gamepadConnected?t.gamepadConnected:null;this._input||(this.resetUserInput(),document.documentElement.tabIndex=1,document.documentElement.addEventListener("keyup",e.SceneManager.inputKeyUpHandler,a),document.documentElement.addEventListener("keydown",e.SceneManager.inputKeyDownHandler,a),document.documentElement.addEventListener("pointerup",e.SceneManager.inputPointerUpHandler,a),document.documentElement.addEventListener("pointerdown",e.SceneManager.inputPointerDownHandler,a),document.documentElement.addEventListener("pointermove",e.SceneManager.inputPointerMoveHandler,a),document.documentElement.addEventListener("onwheel"in document?"wheel":"mousewheel",e.SceneManager.inputPointerWheelHandler,a),e.SceneManager.preventDefault=n,null==e.SceneManager.gamepadManager&&(e.SceneManager.gamepadConnected=o,e.SceneManager.gamepadManager=new e.GamepadManager,e.SceneManager.gamepadManager.onGamepadConnectedObservable.add(e.SceneManager.inputGamepadConnected)),e.SceneManager.virtualJoystick===!1&&(e.SceneManager.virtualJoystick=r,e.SceneManager.virtualJoystick===!0&&(null==e.SceneManager.leftJoystick&&(e.SceneManager.leftJoystick=new e.VirtualJoystick((!0)),e.SceneManager.leftJoystick.setJoystickSensibility(5*e.UserInputOptions.JoystickLeftSensibility)),i===!1&&null==e.SceneManager.rightJoystick&&(e.SceneManager.rightJoystick=new e.VirtualJoystick((!1)),e.SceneManager.rightJoystick.reverseUpDown=!0,e.SceneManager.rightJoystick.setJoystickSensibility(5*e.UserInputOptions.JoystickRightSensibility),e.SceneManager.rightJoystick.setJoystickColor(e.UserInputOptions.JoystickRightHandleColor)))),this._input=!0,document.documentElement.focus())},t.prototype.disableUserInput=function(t){void 0===t&&(t=!1),this._input&&(document.documentElement.removeEventListener("keyup",e.SceneManager.inputKeyUpHandler,t),document.documentElement.removeEventListener("keydown",e.SceneManager.inputKeyDownHandler,t),document.documentElement.removeEventListener("pointerup",e.SceneManager.inputPointerUpHandler,t),document.documentElement.removeEventListener("pointerdown",e.SceneManager.inputPointerDownHandler,t),document.documentElement.removeEventListener("pointermove",e.SceneManager.inputPointerMoveHandler,t),document.documentElement.removeEventListener("onwheel"in document?"wheel":"mousewheel",e.SceneManager.inputPointerWheelHandler,t),e.SceneManager.preventDefault=!1,this.resetUserInput(),this._input=!1)},t.prototype.getUserInput=function(t){var n=0;if(this._input)switch(t){case e.UserInputAxis.Vertical:case e.UserInputAxis.Horizontal:n=t===e.UserInputAxis.Horizontal?e.SceneManager.horizontal:e.SceneManager.vertical;break;case e.UserInputAxis.MouseX:case e.UserInputAxis.MouseY:n=t===e.UserInputAxis.MouseX?e.SceneManager.mousex:e.SceneManager.mousey;break;case e.UserInputAxis.ClientX:case e.UserInputAxis.ClientY:n=t===e.UserInputAxis.ClientX?e.SceneManager.clientx:e.SceneManager.clienty;break;case e.UserInputAxis.Wheel:n=e.SceneManager.wheel}return n},t.prototype.onKeyUp=function(t){this._input&&e.SceneManager.keyButtonUp.push(t)},t.prototype.onKeyDown=function(t){this._input&&e.SceneManager.keyButtonDown.push(t)},t.prototype.onKeyPress=function(t,n){this._input&&e.SceneManager.keyButtonPress.push({index:t,action:n})},t.prototype.getKeyInput=function(t){var n=!1;if(this._input){var a="k"+t.toString();null!=e.SceneManager.keymap[a]&&(n=e.SceneManager.keymap[a])}return n},t.prototype.onPointerUp=function(t){this._input&&e.SceneManager.mouseButtonUp.push(t)},t.prototype.onPointerDown=function(t){this._input&&e.SceneManager.mouseButtonDown.push(t)},t.prototype.onPointerPress=function(t,n){this._input&&e.SceneManager.mouseButtonPress.push({index:t,action:n})},t.prototype.getPointerInput=function(t){var n=!1;if(this._input){var a="p"+t.toString();null!=e.SceneManager.keymap[a]&&(n=e.SceneManager.keymap[a])}return n},t.prototype.onButtonUp=function(t){this._input&&e.SceneManager.gamepadButtonUp.push(t)},t.prototype.onButtonDown=function(t){this._input&&e.SceneManager.gamepadButtonDown.push(t)},t.prototype.onButtonPress=function(t,n){this._input&&e.SceneManager.gamepadButtonPress.push({index:t,action:n})},t.prototype.getButtonInput=function(t){var n=!1;if(this._input){var a="b"+t.toString();null!=e.SceneManager.keymap[a]&&(n=e.SceneManager.keymap[a])}return n},t.prototype.onDpadUp=function(t){this._input&&e.SceneManager.gamepadDpadUp.push(t)},t.prototype.onDpadDown=function(t){this._input&&e.SceneManager.gamepadDpadDown.push(t)},t.prototype.onDpadPress=function(t,n){this._input&&e.SceneManager.gamepadDpadPress.push({index:t,action:n})},t.prototype.getDpadInput=function(t){var n=!1;if(this._input){var a="d"+t.toString();null!=e.SceneManager.keymap[a]&&(n=e.SceneManager.keymap[a])}return n},t.prototype.onTriggerLeft=function(t){this._input&&e.SceneManager.gamepadLeftTrigger.push(t)},t.prototype.onTriggerRight=function(t){this._input&&e.SceneManager.gamepadRightTrigger.push(t)},t.prototype.getTriggerInput=function(t){var n=0;if(this._input){var a="t"+t.toString();null!=e.SceneManager.keymap[a]&&(n=e.SceneManager.keymap[a])}return n},t.prototype.getConnectedGamepad=function(){return this._input?e.SceneManager.gamepad:null},t.prototype.getConnectedGamepadType=function(){return this._input?e.SceneManager.gamepadType:e.GamepadType.None},t.prototype.getLeftJoystick=function(){return this._input?e.SceneManager.leftJoystick:null},t.prototype.getRightJoystick=function(){return this._input?e.SceneManager.rightJoystick:null},t.prototype.getJoystickPress=function(t){var n=!1;return this._input&&(t===e.JoystickButton.Left&&null!=e.SceneManager.leftJoystick&&e.SceneManager.leftJoystick.pressed===!0?n=!0:t===e.JoystickButton.Right&&null!=e.SceneManager.rightJoystick&&e.SceneManager.rightJoystick.pressed===!0&&(n=!0)),n},t.prototype.disposeVirtualJoysticks=function(){this._input&&(null!=e.SceneManager.leftJoystick&&(e.SceneManager.leftJoystick.releaseCanvas(),e.SceneManager.leftJoystick=null),null!=e.SceneManager.rightJoystick&&(e.SceneManager.rightJoystick.releaseCanvas(),e.SceneManager.rightJoystick=null),e.SceneManager.virtualJoystick=!1)},t.prototype.updateCameraPosition=function(t,n,a,r){if(null!=t){var i=t._computeLocalCameraSpeed()*r,o=e.Matrix.RotationYawPitchRoll(t.rotation.y,t.rotation.x,0),s=e.Vector3.TransformCoordinates(new e.Vector3(n*i,0,a*i),o);t.cameraDirection=t.cameraDirection.add(s)}},t.prototype.updateCameraRotation=function(t,n,a,r){null!=t&&(t.cameraRotation=t.cameraRotation.add(new e.Vector2(a*r,n*r)))},t.prototype.updateCameraUserInput=function(t,n,a){if(null!=t){var r=this.getUserInput(e.UserInputAxis.Horizontal),i=this.getUserInput(e.UserInputAxis.Vertical),o=this.getUserInput(e.UserInputAxis.MouseX),s=this.getUserInput(e.UserInputAxis.MouseY);this.updateCameraPosition(t,r,i,n),this.updateCameraRotation(t,o,s,a)}},t.prototype.enableAutoCameraUserInput=function(e,t,n){null!=e&&(this.updateCamera=e,this.cameraInputMoveSpeed=t,this.cameraInputRotateSpeed=n,this.updateCameraInput=!0)},t.prototype.clearAutoCameraUserInput=function(){this.updateCamera=null,this.cameraInputMoveSpeed=1,this.cameraInputRotateSpeed=.005,this.updateCameraInput=!1},t.prototype.autoUpdateCameraUserInput=function(){this.updateCameraUserInput(this.updateCamera,this.cameraInputMoveSpeed,this.cameraInputRotateSpeed)},t.prototype.getNavigationTool=function(){return null==this._navigation&&(this._navigation=new Navigation),this._navigation},t.prototype.getNavigationZone=function(){return"scene"},t.prototype.findNavigationPath=function(e,t){if(null==this._navigation||null==this._navmesh||null==e||null==t)return null;var n=this.getNavigationZone(),a=this._navigation.getGroup(n,e);return this._navigation.findPath(e,t,n,a)},t.prototype.hasNavigationMesh=function(){return null!=this._navmesh},t.prototype.getNavigationMesh=function(){return this._navmesh},t.prototype.buildNavigationMesh=function(t){if(null!=t){this._navmesh=t;var n=this.getNavigationTool(),a=n.buildNodes(this._navmesh);null!=a?n.setZoneData(this.getNavigationZone(),a):e.Tools.Warn("Failed to set scene navigation zone")}},t.prototype.getNavigationPoint=function(t,n,a){var r=this;if(void 0===n&&(n=2),void 0===a&&(a=Number.MAX_VALUE),null==this._navmesh||null==t)return null;var i=(new e.Vector3(t.x,t.y+n,t.z),new e.Ray(t,new e.Vector3(0,(-1),0),a)),o=this._scene.pickWithRay(i,function(e){return e===r._navmesh});return o.hit&&o.pickedPoint?o.pickedPoint:null},t.prototype.moveNavigationAgent=function(t,n,a,r,i){if(n&&n.length>0){for(var o=0,s=[{frame:0,value:t.position}],l=0;l<n.length;l++)o+=e.Vector3.Distance(s[l].value,n[l]),s.push({frame:o,value:n[l]});var u=new e.Animation("Move","position",3,e.Animation.ANIMATIONTYPE_VECTOR3,e.Animation.ANIMATIONLOOPMODE_RELATIVE);u.setKeys(s),t.animations.push(u),this._scene.beginAnimation(t,0,o,r,a,i)}},t.prototype.getNavigationAgents=function(){return this._scene.getMeshesByTags("[NAVAGENT]")},t.prototype.getNavigationAgentInfo=function(t){return new e.NavigationAgent(t)},t.prototype.getNavigationAreaTable=function(){return null!=this._navmesh.metadata&&null!=this._navmesh.metadata.properties&&null!=this._navmesh.metadata.properties.table?this._navmesh.metadata.properties.table:[]},t.prototype.getNavigationAreaIndexes=function(){return null!=this._navmesh.metadata&&null!=this._navmesh.metadata.properties&&null!=this._navmesh.metadata.properties.areas?this._navmesh.metadata.properties.areas:[]},t.prototype.getNavigationAreaName=function(e){var t="";if(null!=this._navmesh.metadata&&null!=this._navmesh.metadata.properties&&null!=this._navmesh.metadata.properties.table){var n=this._navmesh.metadata.properties.table;if(null!=n)for(var a=0;a<n.length;a++)if(n[a].index===e){t=n[a].area;break}}return t},t.prototype.getNavigationAreaCost=function(e){var t=-1;if(null!=this._navmesh.metadata&&null!=this._navmesh.metadata.properties){var n=this._navmesh.metadata.properties.table;if(null!=n)for(var a=0;a<n.length;a++)if(n[a].index===e){t=n[a].cost;break}}return t},t.inputKeyDownHandler=function(t){var n="k"+t.keyCode.toString(),a=!1;switch(null!=e.SceneManager.keymap[n]&&(a=e.SceneManager.keymap[n]),e.SceneManager.keymap[n]=!0,t.keyCode){case 39:case 68:e.SceneManager.k_horizontal=1;break;case 37:case 65:e.SceneManager.k_horizontal=-1;break;case 38:case 87:e.SceneManager.k_vertical=1;break;case 40:case 83:e.SceneManager.k_vertical=-1}return null!=e.SceneManager.keyButtonDown&&e.SceneManager.keyButtonDown.length>0&&e.SceneManager.keyButtonDown.forEach(function(e){e(t.keyCode)}),a||null!=e.SceneManager.keyButtonPress&&e.SceneManager.keyButtonPress.length>0&&e.SceneManager.keyButtonPress.forEach(function(e){e.index===t.keyCode&&e.action()}),e.SceneManager.preventDefault&&t.preventDefault(),!0},t.inputKeyUpHandler=function(t){var n="k"+t.keyCode.toString();switch(e.SceneManager.keymap[n]=!1,t.keyCode){case 39:case 37:case 68:case 65:e.SceneManager.k_horizontal=0;break;case 38:case 40:case 87:case 83:e.SceneManager.k_vertical=0}return null!=e.SceneManager.keyButtonUp&&e.SceneManager.keyButtonUp.length>0&&e.SceneManager.keyButtonUp.forEach(function(e){e(t.keyCode)}),e.SceneManager.preventDefault&&t.preventDefault(),!0},t.inputPointerWheelHandler=function(t){var n=t.deltaY?-t.deltaY:t.wheelDelta/40;return e.SceneManager.x_wheel=Math.abs(n)>e.UserInputOptions.PointerWheelDeadZone?0+n:0,e.SceneManager.preventDefault&&t.preventDefault(),!0},t.inputPointerDownHandler=function(t){0===t.button&&(e.SceneManager.previousPosition={x:t.clientX,y:t.clientY});var n="p"+t.button.toString(),a=!1;return null!=e.SceneManager.keymap[n]&&(a=e.SceneManager.keymap[n]),e.SceneManager.keymap[n]=!0,null!=e.SceneManager.mouseButtonDown&&e.SceneManager.mouseButtonDown.length>0&&e.SceneManager.mouseButtonDown.forEach(function(e){e(t.button)}),a||null!=e.SceneManager.mouseButtonPress&&e.SceneManager.mouseButtonPress.length>0&&e.SceneManager.mouseButtonPress.forEach(function(e){e.index===t.button&&e.action()}),e.SceneManager.preventDefault&&t.preventDefault(),!0},t.inputPointerUpHandler=function(t){0===t.button&&null!=e.SceneManager.previousPosition&&(e.SceneManager.previousPosition=null,e.SceneManager.k_mousex=0,e.SceneManager.k_mousey=0);var n="p"+t.button.toString();return e.SceneManager.keymap[n]=!1,null!=e.SceneManager.mouseButtonUp&&e.SceneManager.mouseButtonUp.length>0&&e.SceneManager.mouseButtonUp.forEach(function(e){e(t.button)}),e.SceneManager.preventDefault&&t.preventDefault(),!0},t.inputPointerMoveHandler=function(t){if(e.SceneManager.virtualJoystick===!1&&null!=e.SceneManager.previousPosition){e.SceneManager.clientx=t.clientX,e.SceneManager.clienty=t.clientY;var n=t.clientX-e.SceneManager.previousPosition.x,a=t.clientY-e.SceneManager.previousPosition.y;e.SceneManager.previousPosition={x:t.clientX,y:t.clientY};var r=n*(e.UserInputOptions.PointerAngularSensibility/10),i=a*(e.UserInputOptions.PointerAngularSensibility/10);0!=r&&(e.SceneManager.k_mousex=r),0!=i&&(e.SceneManager.rightHanded?e.SceneManager.k_mousey=-i:e.SceneManager.k_mousey=i)}return e.SceneManager.preventDefault&&t.preventDefault(),!0},t.inputButtonDownHandler=function(t){if(null!=e.SceneManager.gamepad){var n="b"+t.toString(),a=!1;null!=e.SceneManager.keymap[n]&&(a=e.SceneManager.keymap[n]),e.SceneManager.keymap[n]=!0,null!=e.SceneManager.gamepadButtonDown&&e.SceneManager.gamepadButtonDown.length>0&&e.SceneManager.gamepadButtonDown.forEach(function(e){e(t)}),a||null!=e.SceneManager.gamepadButtonPress&&e.SceneManager.gamepadButtonPress.length>0&&e.SceneManager.gamepadButtonPress.forEach(function(e){e.index===t&&e.action()})}},t.inputButtonUpHandler=function(t){if(null!=e.SceneManager.gamepad){var n="b"+t.toString();e.SceneManager.keymap[n]=!1,null!=e.SceneManager.gamepadButtonUp&&e.SceneManager.gamepadButtonUp.length>0&&e.SceneManager.gamepadButtonUp.forEach(function(e){e(t)})}},t.inputXboxDPadDownHandler=function(t){if(null!=e.SceneManager.gamepad){var n="d"+t.toString(),a=!1;null!=e.SceneManager.keymap[n]&&(a=e.SceneManager.keymap[n]),e.SceneManager.keymap[n]=!0,null!=e.SceneManager.gamepadDpadDown&&e.SceneManager.gamepadDpadDown.length>0&&e.SceneManager.gamepadDpadDown.forEach(function(e){e(t)}),a||null!=e.SceneManager.gamepadDpadPress&&e.SceneManager.gamepadDpadPress.length>0&&e.SceneManager.gamepadDpadPress.forEach(function(e){e.index===t&&e.action()})}},t.inputXboxDPadUpHandler=function(t){if(null!=e.SceneManager.gamepad){var n="d"+t.toString();e.SceneManager.keymap[n]=!1,null!=e.SceneManager.gamepadDpadUp&&e.SceneManager.gamepadDpadUp.length>0&&e.SceneManager.gamepadDpadUp.forEach(function(e){e(t)})}},t.inputXboxLeftTriggerHandler=function(t){null!=e.SceneManager.gamepad&&(e.SceneManager.keymap.t0=t,null!=e.SceneManager.gamepadLeftTrigger&&e.SceneManager.gamepadLeftTrigger.length>0&&e.SceneManager.gamepadLeftTrigger.forEach(function(e){e(t)}))},t.inputXboxRightTriggerHandler=function(t){null!=e.SceneManager.gamepad&&(e.SceneManager.keymap.t1=t,null!=e.SceneManager.gamepadRightTrigger&&e.SceneManager.gamepadRightTrigger.length>0&&e.SceneManager.gamepadRightTrigger.forEach(function(e){e(t)}))},t.inputLeftStickHandler=function(t){if(null!=e.SceneManager.gamepad){var n=t,a=n.x*e.UserInputOptions.GamepadLStickSensibility,r=n.y*e.UserInputOptions.GamepadLStickSensibility;n.x=Math.abs(a)>e.UserInputOptions.GamepadDeadStickValue?0+a:0,n.y=Math.abs(r)>e.UserInputOptions.GamepadDeadStickValue?0+r:0,e.SceneManager.g_horizontal=e.UserInputOptions.GamepadLStickXInverted?-n.x:n.x,e.SceneManager.g_vertical=e.UserInputOptions.GamepadLStickYInverted?n.y:-n.y}},t.inputRightStickHandler=function(t){if(null!=e.SceneManager.gamepad){var n=t,a=n.x*e.UserInputOptions.GamepadRStickSensibility,r=n.y*e.UserInputOptions.GamepadRStickSensibility;n.x=Math.abs(a)>e.UserInputOptions.GamepadDeadStickValue?0+a:0,n.y=Math.abs(r)>e.UserInputOptions.GamepadDeadStickValue?0+r:0,e.SceneManager.g_mousex=e.UserInputOptions.GamepadRStickXInverted?-n.x:n.x,e.SceneManager.g_mousey=e.UserInputOptions.GamepadRStickYInverted?-n.y:n.y}},t.inputGamepadConnected=function(t,n){if(null!=t&&0===t.index&&null==e.SceneManager.gamepad){if(e.SceneManager.gamepad=t,e.Tools.Log("Gamepad Connected: "+e.SceneManager.gamepad.id),e.SceneManager.gamepad.id.search("Xbox 360")!==-1||e.SceneManager.gamepad.id.search("Xbox One")!==-1||e.SceneManager.gamepad.id.search("xinput")!==-1){e.SceneManager.gamepadType=e.GamepadType.Xbox360;var a=e.SceneManager.gamepad;a.onbuttonup(e.SceneManager.inputButtonUpHandler),a.onbuttondown(e.SceneManager.inputButtonDownHandler),a.onleftstickchanged(e.SceneManager.inputLeftStickHandler),a.onrightstickchanged(e.SceneManager.inputRightStickHandler),a.ondpadup(e.SceneManager.inputXboxDPadUpHandler),a.ondpaddown(e.SceneManager.inputXboxDPadDownHandler),a.onlefttriggerchanged(e.SceneManager.inputXboxLeftTriggerHandler),a.onrighttriggerchanged(e.SceneManager.inputXboxRightTriggerHandler)}else{e.SceneManager.gamepadType=e.GamepadType.Generic;var r=e.SceneManager.gamepad;r.onbuttonup(e.SceneManager.inputButtonUpHandler),r.onbuttondown(e.SceneManager.inputButtonDownHandler),r.onleftstickchanged(e.SceneManager.inputLeftStickHandler),r.onrightstickchanged(e.SceneManager.inputRightStickHandler)}null!=e.SceneManager.gamepadConnected&&e.SceneManager.gamepadConnected(e.SceneManager.gamepad,e.SceneManager.gamepadType)}},t.inputVirtualJoysticks=function(){if(null!=e.SceneManager.leftJoystick){var t=e.SceneManager.leftJoystick.deltaPosition;e.SceneManager.leftJoystick.pressed||(t=t.scale(.9));var n=t.x,a=t.y;t.x=Math.abs(n)>e.UserInputOptions.JoystickDeadStickValue?0+n:0,t.y=Math.abs(a)>e.UserInputOptions.JoystickDeadStickValue?0+a:0,e.SceneManager.j_horizontal=t.x,e.SceneManager.j_vertical=t.y;
}if(null!=e.SceneManager.rightJoystick){var r=e.SceneManager.rightJoystick.deltaPosition;e.SceneManager.rightJoystick.pressed||(r=r.scale(.9));var i=r.x,o=r.y;r.x=Math.abs(i)>e.UserInputOptions.JoystickDeadStickValue?0+i:0,r.y=Math.abs(o)>e.UserInputOptions.JoystickDeadStickValue?0+o:0,e.SceneManager.j_mousex=r.x,e.SceneManager.j_mousey=r.y}},t.updateUserInput=function(){e.SceneManager.inputVirtualJoysticks(),e.SceneManager.x_horizontal=0,e.SceneManager.x_vertical=0,e.SceneManager.x_mousex=0,e.SceneManager.x_mousey=0,0!==e.SceneManager.j_horizontal?e.SceneManager.x_horizontal=e.SceneManager.j_horizontal:0!==e.SceneManager.k_horizontal?e.SceneManager.x_horizontal=e.SceneManager.k_horizontal:0!==e.SceneManager.g_horizontal&&(e.SceneManager.x_horizontal=e.SceneManager.g_horizontal),0!==e.SceneManager.j_vertical?e.SceneManager.x_vertical=e.SceneManager.j_vertical:0!==e.SceneManager.k_vertical?e.SceneManager.x_vertical=e.SceneManager.k_vertical:0!==e.SceneManager.g_vertical&&(e.SceneManager.x_vertical=e.SceneManager.g_vertical),0!==e.SceneManager.j_mousex?e.SceneManager.x_mousex=e.SceneManager.j_mousex:0!==e.SceneManager.k_mousex?e.SceneManager.x_mousex=e.SceneManager.k_mousex:0!==e.SceneManager.g_mousex&&(e.SceneManager.x_mousex=e.SceneManager.g_mousex),0!==e.SceneManager.j_mousey?e.SceneManager.x_mousey=e.SceneManager.j_mousey:0!==e.SceneManager.k_mousey?e.SceneManager.x_mousey=e.SceneManager.k_mousey:0!==e.SceneManager.g_mousey&&(e.SceneManager.x_mousey=e.SceneManager.g_mousey),e.SceneManager.horizontal=e.SceneManager.x_horizontal,e.SceneManager.vertical=e.SceneManager.x_vertical,e.SceneManager.mousex=e.SceneManager.x_mousex,e.SceneManager.mousey=e.SceneManager.x_mousey,e.SceneManager.wheel=e.SceneManager.x_wheel,e.SceneManager.x_mousey=0,e.SceneManager.me.updateCameraInput===!0&&null!=e.SceneManager.me.updateCamera&&e.SceneManager.me.autoUpdateCameraUserInput()},t.parseSceneMetadata=function(t,n){window.parsing=!0;var a=n;null==a.manager?(e.SceneManager.CreateManagerSession(t,n),null==a.manager&&e.Tools.Warn("Failed to create a new manager session for current scene.")):e.Tools.Warn("Current scene has already been parsed."),window.parsing=!1},t.parseMeshMetadata=function(t,n){window.parsing=!0;var a=n;if(null!=a.manager){var r=(a.manager,[]);e.SceneManager.parseSceneMeshes(t,n,r),r.length>0&&(r.sort(function(e,t){return e.order<t.order?-1:e.order>t.order?1:0}),r.forEach(function(e){e.instance.register()}))}else e.Tools.Warn("No scene manager detected for current scene.");window.parsing=!1},t.parseSceneCameras=function(t,n,a){null!=t&&t.length>0&&t.forEach(function(t){if(null!=t.metadata&&t.metadata.api){t.metadata.clone=function(){return e.SceneManager.CloneMetadata(t.metadata)},null!=t.metadata.disposal&&t.metadata.disposal!==!1||(t.onDispose=function(){e.SceneManager.DestroyComponents(t)},t.metadata.disposal=!0);var r=t.metadata;null!=r.components&&r.components.length>0&&r.components.forEach(function(r){if(null!=r.klass&&""!==r.klass&&"BABYLON.SceneComponent"!==r.klass&&"BABYLON.OrthoController"!==r.klass){var i=e.Tools.Instantiate(r.klass);null!=i&&(r.instance=new i(t,n,r.update,r.properties),null!=r.instance&&null!=a&&a.push(r))}}),e.SceneManager.setupCameraRigOptions(t,n,a),e.SceneManager.setupAnimationState(t,n)}})},t.parseSceneLights=function(t,n,a){null!=t&&t.length>0&&t.forEach(function(t){if(null!=t.metadata&&t.metadata.api){t.metadata.clone=function(){return e.SceneManager.CloneMetadata(t.metadata)},null!=t.metadata.disposal&&t.metadata.disposal!==!1||(t.onDispose=function(){e.SceneManager.DestroyComponents(t)},t.metadata.disposal=!0);var r=t.metadata;null!=r.components&&r.components.length>0&&r.components.forEach(function(r){if(null!=r.klass&&""!==r.klass&&"BABYLON.SceneComponent"!==r.klass&&"BABYLON.OrthoController"!==r.klass){var i=e.Tools.Instantiate(r.klass);null!=i&&(r.instance=new i(t,n,r.update,r.properties),null!=r.instance&&null!=a&&a.push(r))}}),e.SceneManager.setupAnimationState(t,n)}})},t.parseSceneMeshes=function(t,n,a){null!=t&&t.length>0&&(t.forEach(function(t){if(null!=t.metadata&&t.metadata.api)if(t.metadata.clone=function(){return e.SceneManager.CloneMetadata(t.metadata)},e.SceneManager.setupSharedSkeleton(t,n),t.metadata.prefab===!0)t.setEnabled(!1),e.SceneManager.prefabs[t.name]=t,e.SceneManager.setupLodGroups(t,n,!0);else{if(e.SceneManager.setupLodGroups(t,n,!1),null!=t.metadata.disposal&&t.metadata.disposal!==!1||(t.onDispose=function(){e.SceneManager.DestroyComponents(t)},t.metadata.disposal=!0),"sceneNavigationMesh"===t.name&&null!=n.metadata.properties.hasNavigationMesh&&n.metadata.properties.hasNavigationMesh===!0&&(e.SceneManager.me.hasNavigationMesh()===!1?e.SceneManager.me.buildNavigationMesh(t):e.Tools.Warn("Scene navigation mesh already exists. Ignoring navigation zone building for mesh: "+t.name)),null!=t.metadata.properties&&null!=t.metadata.properties.physicsTag){var r=(t.metadata.properties.physicsTag,t.metadata.properties.physicsMass),i=t.metadata.properties.physicsFriction,o=t.metadata.properties.physicsRestitution,s=t.metadata.properties.physicsImpostor,l=t.metadata.properties.physicsRotation,u=t.metadata.properties.physicsCollisions,c=t.metadata.properties.physicsEnginePlugin;t.physicsImpostor=new e.PhysicsImpostor(t,s,{mass:r,friction:i,restitution:o},n),e.SceneManager.setupPhysicsImpostor(t,c,i,u,l)}var p=t.metadata;if(null!=p.components&&p.components.length>0&&p.components.forEach(function(r){if(null!=r.klass&&""!==r.klass&&"BABYLON.SceneComponent"!==r.klass&&"BABYLON.OrthoController"!==r.klass){var i=e.Tools.Instantiate(r.klass);null!=i&&(r.instance=new i(t,n,r.update,r.properties),null!=r.instance&&null!=a&&a.push(r))}}),e.SceneManager.setupAnimationState(t,n),e.SceneManager.setupTerrainMeshes(t,n),e.SceneManager.setupSocketMeshes(t,n),null!=t.metadata&&t.metadata.properties&&null!=t.metadata.properties){if(t.metadata.properties.defaultEllipsoid&&null!=t.metadata.properties.defaultEllipsoid&&t.metadata.properties.defaultEllipsoid.length>=3){var h=t.metadata.properties.defaultEllipsoid;t.ellipsoid=new e.Vector3(h[0],h[1],h[2])}if(t.metadata.properties.ellipsoidOffset&&null!=t.metadata.properties.ellipsoidOffset&&t.metadata.properties.ellipsoidOffset.length>=3){var d=t.metadata.properties.ellipsoidOffset;t.ellipsoidOffset=new e.Vector3(d[0],d[1],d[2])}t.metadata.properties.hasOwnProperty("freezeWorldMatrix")&&t.metadata.properties.freezeWorldMatrix===!0&&t.freezeWorldMatrix(),t.metadata.properties.hasOwnProperty("convertToUnIndexed")&&t.metadata.properties.convertToUnIndexed===!0&&t.convertToUnIndexedMesh(),t.metadata.properties.hasOwnProperty("convertToFlatShaded")&&t.metadata.properties.convertToFlatShaded===!0&&t.convertToFlatShadedMesh()}}}),e.SceneManager.postParseSceneMeshes(t,n))},t.postParseSceneMeshes=function(t,n){if(null!=t&&t.length>0){var a={};if(t.forEach(function(t){if(null!=t.metadata&&t.metadata.api&&e.SceneManager.staticVertexLimit===!1&&t.metadata.layerIndex===e.SceneManager.StaticIndex&&t.name.indexOf("_StaticMesh_")>=0){t.metadata.layerIndex=-99;var n=t.material.id,r=null;a.hasOwnProperty(n)?r=a[n]:(r=[],a[n]=r),r.push(t)}}),e.SceneManager.staticVertexLimit===!1)for(var r in a)if(a.hasOwnProperty(r)){var i=a[r];if(null!=i&&i.length>1){var o=i[0].parent,s=e.Mesh.MergeMeshes(i,!0,!0);null!=s&&(s.parent=o)}}}},t.setupLodGroups=function(t,n,a){if(null!=t&&null!=t.metadata&&t.metadata.properties&&null!=t.metadata.properties&&t.metadata.properties.lodGroupInfo&&null!=t.metadata.properties.lodGroupInfo){var r=t.metadata.properties.lodGroupInfo,i=(r.lodCount,r.lodDetails),o=(r.fadeMode,r.crossFading,r.startCulling),s=(r.nearClipingPlane,r.farClipingPlane,r.cameraDistanceFactor,t.getChildMeshes(!1));if(null!=i&&i.length>0&&null!=s&&s.length>0){var l=null;i.forEach(function(t){var r=(t.startingPercent,t.endingPercent,t.rendererCount,t.lodRenderers),i=(t.lodDistance,t.startRange);if(null!=r&&r.length>0){var o=r[0],u=o.name,c=e.SceneManager.FindMesh(u,s,e.SearchType.IndexOf),p=null;null!=c&&(null!=c.metadata&&c.metadata.tagName&&null!=c.metadata.tagName&&"[INSTANCE]"===c.metadata.tagName&&c.metadata.properties&&null!=c.metadata.properties&&c.metadata.properties.prefabSource&&null!=c.metadata.properties.prefabSource&&""!==c.metadata.properties.prefabSource&&(p=c,c=n.getMeshByID(c.metadata.properties.prefabSource)),null!=c&&(null==l&&(l=c,l.setEnabled(!1)),c!=l&&(a===!0?(null==e.SceneManager.orphans&&(e.SceneManager.orphans=new e.Mesh("Prefab.Orphans",n),e.SceneManager.orphans.setEnabled(!0),e.SceneManager.orphans.isVisible=!0),c.parent=e.SceneManager.orphans):c.parent=l,l.addLODLevel(i,c),null!=p&&(p.parent=null,p.metadata.tagName=null,p.metadata.prefabSource=null,e.SceneManager.me.safeDestroy(p)))))}}),null!=l&&(o>0&&l.addLODLevel(o,null),l.setEnabled(!0))}t.metadata.properties.lodGroupInfo=null}},t.setupTerrainMeshes=function(t,n){if(null!=t&&null!=t.metadata&&t.metadata.properties&&null!=t.metadata.properties){var a=0;if(t.metadata.properties.treeInstances&&null!=t.metadata.properties.treeInstances&&t.metadata.properties.treeInstances.length>0){var r=t.metadata.properties.treeInstances;r.forEach(function(n){a++;var r=n.prefab,i=(n.color,n.heightScale),o=(n.lightmapColor,n.position),s=n.rotation,l=n.widthScale,u=r+"_"+a.toString(),c=t,p=new e.Vector3(o[0],o[1],o[2]),h=new e.Vector3(0,s,0),d=new e.Vector3(l,i,l);e.SceneManager.me.onready(function(){e.SceneManager.me.instantiatePrefab(r,u,p,h,d,c)})})}if(a=0,t.metadata.properties.detailPrototypes&&null!=t.metadata.properties.detailPrototypes&&t.metadata.properties.detailPrototypes.length>0){var i=t.metadata.properties.detailPrototypes;i.forEach(function(e){})}}},t.setupSocketMeshes=function(t,n){if(null!=t&&null!=t.metadata.socketList&&t.metadata.socketList.length>0&&null!=t.skeleton&&null!=t.skeleton.bones&&t.skeleton.bones.length>0){var a=t.metadata.socketList;a.forEach(function(a){if(t.skeleton.bones.length>=a.boneIndex+1){var r=t.skeleton.bones[a.boneIndex],i=a.boneName+".Socket.";if(null!=t.parent&&(i+=t.parent.name+"."),i+=t.name+"."+e.Tools.RandomId(),e.SceneManager.showDebugSockets===!0?(a.socketMesh=e.Mesh.CreateBox(i,e.SceneManager.socketColliderSize,n),a.socketMesh.visibility=e.SceneManager.colliderVisibility):a.socketMesh=new e.Mesh(i,n),a.socketMesh.position=new e.Vector3(a.positionX,a.positionY,a.positionZ),a.socketMesh.rotation=new e.Vector3(a.rotationX,a.rotationY,a.rotationZ),a.socketMesh.checkCollisions=!1,a.socketMesh.attachToBone(r,t),null!=a.prefabName&&""!==a.prefabName){var o=new e.Vector3(a.prefabPositionX,a.prefabPositionY,a.prefabPositionZ),s=new e.Vector3(a.prefabRotationX,a.prefabRotationY,a.prefabRotationZ);e.SceneManager.me.onready(function(){e.SceneManager.me.instantiatePrefab(a.prefabName,a.prefabName,o,s,null,a.socketMesh)})}}})}},t.setupSharedSkeleton=function(t,n){if(null!=t&&null!=t.metadata&&t.metadata.properties&&null!=t.metadata.properties&&t.metadata.properties.sharedSkeletonId&&""!==t.metadata.properties.sharedSkeletonId){var a=t.metadata.properties.sharedSkeletonId,r=n.getMeshByID(a);if(null!=r&&null!=r.skeleton){var i=[];null!=r.metadata.animationClips&&r.metadata.animationClips.length>0&&r.metadata.animationClips.forEach(function(t){var n={};e.SceneManager.DeepCopyProperties(t,n),i.push(n)}),t.metadata.animationClips=i,t.skeleton=r.skeleton.clone(t.name,t.name+".Clone."+e.Tools.RandomId())}else e.Tools.Warn("Failed to locate source skeleton: "+a)}},t.setupPhysicsImpostor=function(t,n,a,r,i){null!=t&&null!=t.physicsImpostor&&t.physicsImpostor.executeNativeFunction(function(o,s){s?0===n&&(s.linearDamping=a,s.angularDamping=a,s.collisionResponse=r,s.angularVelocity.x=0,s.angularVelocity.y=0,s.angularVelocity.z=0,s.velocity.x=0,s.velocity.y=0,s.velocity.z=0,1===i&&(s.fixedRotation=!0,s.updateMassProperties())):e.Tools.Warn("[Physics Native Function]: Null imposter body encountered for physcis mesh "+t.name+". Check physics mesh has no parent transform.")})},t.setupCameraRigOptions=function(t,n,a){if(null!=t&&null!=t.metadata&&null!=t.metadata.properties){if(t.mode===e.Camera.ORTHOGRAPHIC_CAMERA){var r=t.metadata.properties.orthographicSize||5,i="BABYLON.OrthoController",o=null==n.metadata||null==n.metadata.properties||!n.metadata.properties.hasOwnProperty("resizeCameras")||n.metadata.properties.resizeCameras,s=t.metadata;null==s.components&&(s.components=[]);var l=e.Tools.Instantiate(i);if(null!=l){var u={orthoSize:r,resizeCameras:o},c=new l(t,n,(!1),u);if(null!=c){var p={order:1e3,name:"EditorScriptComponent",klass:i,update:!1,properties:u,instance:c,tag:{}};s.components.push(p),c.register()}}}if(t.metadata.properties.cameraType){var h=t.metadata.properties.cameraType;if("WebVRFreeCamera"===h||"WebVRGamepadCamera"===h){t.metadata.properties.wvrTrackPosition,t.metadata.properties.wvrPositionScale,t.metadata.properties.wvrDisplayName}else if("VRDeviceOrientationFreeCamera"===h||"VRDeviceOrientationGamepadCamera"===h){var d=t.metadata.properties.vrCameraBridge,m=t.metadata.properties.vrEyeToScreen,f=t.metadata.properties.vrInterpupillary,g=t.metadata.properties.vrScreenCenter,y=t.metadata.properties.vrVerticalRes,_=t.metadata.properties.vrHorizontalRes,S=t.metadata.properties.vrVerticalScreen,v=t.metadata.properties.vrHorizontalScreen,M=t.metadata.properties.vrLensCenterOffset,b=t.metadata.properties.vrLensSeparation,k=t.metadata.properties.vrPostProcessScale,x=t.metadata.properties.vrCompensateDistortion,w=t,P=.5-d,T=.5+d,I=e.VRCameraMetrics.GetDefault();I.eyeToScreenDistance=m,I.interpupillaryDistance=f,I.lensSeparationDistance=b,I.lensCenterOffset=M,I.hResolution=_,I.vResolution=y,I.vScreenCenter=g,I.vScreenSize=S,I.hScreenSize=v,I.postProcessScaleFactor=k,I.compensateDistortion=x,w.setCameraRigMode(e.Camera.RIG_MODE_VR,{vrCameraMetrics:I,interaxialDistance:t.interaxialDistance}),w._rigCameras[0].viewport=new e.Viewport(0,0,P,1),w._rigCameras[1].viewport=new e.Viewport(T,0,P,1),n.clearColor=new e.Color4(0,0,0,1)}}if(t.metadata.properties.cameraInput&&t.metadata.properties.cameraInput>0){var C=t.metadata.properties.cameraInput;if(1===C){var A=!!t.metadata.properties.hasOwnProperty("preventDefaultEvents")&&t.metadata.properties.preventDefaultEvents;t.attachControl(n.getEngine().getRenderingCanvas(),!A)}else if(2===C){var O=!0;if(O){var E=1,B=.005;t.metadata.properties.cameraMoveSpeed&&(E=t.metadata.properties.cameraMoveSpeed),t.metadata.properties.cameraRotateSpeed&&(B=t.metadata.properties.cameraRotateSpeed),e.SceneManager.me.enableAutoCameraUserInput(t,E,B)}}}}},t.setupAnimationState=function(t,n){if(null!=t&&null!=t.metadata&&t.metadata.api){var a=t.metadata,r=e.SceneManager.me.findSceneComponent("BABYLON.AnimationState",t);if(null!=r&&null!=a.animationEvents&&a.animationEvents.length>0&&null!=a.components&&a.components.length>0){var i=e.SceneManager.locateOwnerAnimationTrack(0,t,!1);null!=i&&a.animationEvents.forEach(function(t){if(null!=t.functionName&&""!==t.functionName){var n=t.functionName.toLowerCase();i.addEvent(new e.AnimationEvent(t.frame,function(){var e=r;if(null!=e._handlers&&e._handlers[n]){var a=e._handlers[n];a&&a(t)}}))}})}}},t.locateOwnerSocketMesh=function(t,n,a){void 0===a&&(a=e.SearchType.StartsWith);var r=null;if(null!=n&&n.metadata&&null!=n.metadata&&n.metadata.socketList&&null!=n.metadata.socketList&&n.metadata.socketList.length>0){var i=n.metadata.socketList,o=null!=a?a:e.SearchType.StartsWith,s=0;for(s=0;s<i.length;s++){var l=i[s];if(o===e.SearchType.StartsWith){if(e.Utilities.StartsWith(l.boneName,t)){r=l.socketMesh;break}}else if(o===e.SearchType.EndsWith){if(e.Utilities.EndsWith(l.boneName,t)){r=l.socketMesh;break}}else if(o===e.SearchType.IndexOf){if(l.boneName.indexOf(t)>=0){r=l.socketMesh;break}}else if(l.boneName===t){r=l.socketMesh;break}}}return r},t.locateOwnerSocketMeshes=function(e){var t=null;if(null!=e&&e.metadata&&null!=e.metadata&&e.metadata.socketList&&null!=e.metadata.socketList&&e.metadata.socketList.length>0){t=[];var n=e.metadata.socketList;n.forEach(function(e){t.push(e.socketMesh)})}return t},t.locateOwnerAnimationTrack=function(t,n,a,r){void 0===a&&(a=!0),void 0===r&&(r=null);var i=null;if(null!=n&&n instanceof e.AbstractMesh){var o=n;if(null!=o.skeleton&&null!=o.skeleton.bones&&o.skeleton.bones.length>0&&o.skeleton.bones[0]){var s=o.skeleton.bones[0];null!=s.animations&&s.animations.length>t&&null!=s.animations[t]&&(i=s.animations[t])}}if(null==i&&null!=n.animations&&n.animations.length>t&&null!=n.animations[t]&&(i=n.animations[t]),null==i&&n instanceof e.AbstractMesh){var l=n.getChildMeshes(a,r);if(null!=l&&l.length>0)for(var u=0;u<l.length;u++){var c=l[u];if(null!=c.skeleton&&null!=c.skeleton.bones&&c.skeleton.bones.length>0&&c.skeleton.bones[0]){var p=c.skeleton.bones[0];if(null!=p.animations&&p.animations.length>t&&null!=p.animations[t]){i=p.animations[t];break}}if(null==i&&null!=c.animations&&c.animations.length>0&&c.animations.length>t&&null!=c.animations[t]){i=c.animations[t];break}}}return i},t.DestroyComponents=function(e,t){if(void 0===t&&(t=!0),null!=e&&null!=e.metadata&&e.metadata.api){var n=e.metadata;null!=n.components&&n.components.length>0&&n.components.forEach(function(e){null!=e.instance&&(e.instance.dispose(),e.instance=null)}),null!=n.socketList&&n.socketList.length>0&&n.socketList.forEach(function(e){null!=e.socketMesh&&(e.socketMesh.dispose(),e.socketMesh=null)}),t&&(null!=e.metadata.components&&(e.metadata.components=null),null!=e.metadata.properties&&(e.metadata.properties=null),null!=e.metadata.socketList&&(e.metadata.socketList=null),null!=e.metadata.animationClips&&(e.metadata.animationClips=null),null!=e.metadata.animationEvents&&(e.metadata.animationEvents=null),null!=e.metadata.collisionEvent&&(e.metadata.collisionEvent=null),e.metadata=null)}},t.SetAnimationBlending=function(e,t){if(null!=e)for(var n=e.animations,a=0;a<n.length;a++)n[a].enableBlending=t>0,n[a].blendingSpeed=t},t.SetSkeletonBlending=function(e,t){null!=e&&e.bones.forEach(function(e){e.animations.forEach(function(e){e.enableBlending=t>0,e.blendingSpeed=t})})},t.SetAnimationLooping=function(e,t){if(null!=e)for(var n=e.animations,a=0;a<n.length;a++)n[a].loopMode=t},t.SetSkeletonLooping=function(e,t){null!=e&&e.bones.forEach(function(e){e.animations.forEach(function(e){e.loopMode=t})})},t.SetAnimationProperties=function(e,t,n){if(null!=e)for(var a=e.animations,r=0;r<a.length;r++)a[r].enableBlending=n>0,a[r].blendingSpeed=n,a[r].loopMode=t},t.SetSkeletonProperties=function(e,t,n){null!=e&&e.bones.forEach(function(e){e.animations.forEach(function(e){e.enableBlending=n>0,e.blendingSpeed=n,e.loopMode=t})})},t.FindMesh=function(t,n,a){void 0===a&&(a=e.SearchType.StartsWith);var r=null,i=null!=a?a:e.SearchType.StartsWith;if(null!=n&&n.length>0)for(var o=0;o<n.length;o++){var s=n[o];if(i===e.SearchType.StartsWith){if(e.Utilities.StartsWith(s.name,t)){r=s;break}}else if(i===e.SearchType.EndsWith){if(e.Utilities.EndsWith(s.name,t)){r=s;break}}else if(i===e.SearchType.IndexOf){if(s.name.indexOf(t)>=0){r=s;break}}else if(s.name===t){r=s;break}}return r},t.CloneValue=function(t,n){return t?t instanceof e.Mesh?null:t instanceof e.SubMesh?t.clone(n):t.clone?t.clone():t:null},t.CloneMetadata=function(t){var n=null;if(null!=t){var a={};e.SceneManager.DeepCopyProperties(t.properties,a);var r={};e.SceneManager.DeepCopyProperties(t.navAgent,r);var i={};e.SceneManager.DeepCopyProperties(t.meshLink,i);var o={};e.SceneManager.DeepCopyProperties(t.meshObstacle,o);var s=[];null!=t.socketList&&t.socketList.length>0&&t.socketList.forEach(function(t){var n={};e.SceneManager.DeepCopyProperties(t,n),s.push(n)});var l=[];null!=t.animationClips&&t.animationClips.length>0&&t.animationClips.forEach(function(t){var n={};e.SceneManager.DeepCopyProperties(t,n),l.push(n)});var u=[];null!=t.animationEvents&&t.animationEvents.length>0&&t.animationEvents.forEach(function(t){var n={};e.SceneManager.DeepCopyProperties(t,n),u.push(n)});var c=[];null!=t.components&&t.components.length>0&&t.components.forEach(function(t){var n={};e.SceneManager.DeepCopyProperties(t.properties,n),c.push({name:t.name,klass:t.klass,order:t.order,tag:t.tag,update:t.update,properties:n,instance:null})}),n={api:!0,type:t.type,prefab:!1,state:{},objectName:t.objectName,objectId:t.objectId,tagName:t.tagName,layerIndex:t.layerIndex,layerName:t.layerName,areaIndex:t.areaIndex,navAgent:r,meshLink:i,meshObstacle:o,socketList:s,animationClips:l,animationEvents:l,collisionEvent:null,components:c,properties:a}}return n},t.DeepCopyProperties=function(t,n,a,r){for(var i in t)if(("_"!==i[0]||r&&r.indexOf(i)!==-1)&&(!a||a.indexOf(i)===-1)){var o=t[i],s=typeof o;if("function"!==s)if("object"===s)if(o instanceof Array){if(n[i]=[],o.length>0)if("object"==typeof o[0])for(var l=0;l<o.length;l++){var u=e.SceneManager.CloneValue(o[l],n);n[i].indexOf(u)===-1&&n[i].push(u)}else n[i]=o.slice(0)}else n[i]=e.SceneManager.CloneValue(o,n);else n[i]=o}},t.me=null,t.min=Number.MIN_VALUE,t.max=Number.MAX_VALUE-100,t.keymap={},t.prefabs=null,t.wheel=0,t.clientx=0,t.clienty=0,t.mousex=0,t.mousey=0,t.vertical=0,t.horizontal=0,t.x_wheel=0,t.x_mousex=0,t.x_mousey=0,t.x_vertical=0,t.x_horizontal=0,t.k_mousex=0,t.k_mousey=0,t.k_vertical=0,t.k_horizontal=0,t.j_mousex=0,t.j_mousey=0,t.j_vertical=0,t.j_horizontal=0,t.g_mousex=0,t.g_mousey=0,t.g_vertical=0,t.g_horizontal=0,t.engine=null,t.orphans=null,t.gamepad=null,t.gamepadType=e.GamepadType.None,t.gamepadManager=null,t.gamepadConnected=null,t.gamepadButtonPress=[],t.gamepadButtonDown=[],t.gamepadButtonUp=[],t.gamepadDpadPress=[],t.gamepadDpadDown=[],t.gamepadDpadUp=[],t.gamepadLeftTrigger=[],t.gamepadRightTrigger=[],t.mouseButtonPress=[],t.mouseButtonDown=[],t.mouseButtonUp=[],t.keyButtonPress=[],t.keyButtonDown=[],t.keyButtonUp=[],t.leftJoystick=null,t.rightJoystick=null,t.virtualJoystick=!1,t.showDebugSockets=!1,t.colliderVisibility=.25,t.socketColliderSize=.125,t.staticVertexLimit=!1,t.previousPosition=null,t.preventDefault=!1,t.rightHanded=!0,t.loader=null,t.readies=[],t}();e.SceneManager=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(e){if(null==e)throw new Error("Null owner agent mesh specified.");this._mesh=e,this._info=null!=this._mesh.metadata&&null!=this._mesh.metadata.navAgent?this._mesh.metadata.navAgent:null}return Object.defineProperty(t.prototype,"mesh",{get:function(){return this._mesh},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"info",{get:function(){return this._info},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasAgentInfo",{get:function(){return null!=this.info},enumerable:!0,configurable:!0}),t.prototype.setDestination=function(t){this.hasAgentInfo||e.Tools.Warn("Null navigation agent metadata. Set agent destination ignored.")},t}();e.NavigationAgent=t}(BABYLON||(BABYLON={}));var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),BABYLON;!function(e){var t=function(t){function n(e,n,a,r){void 0===a&&(a=!0),void 0===r&&(r={});var i=t.call(this,e,n,a,r)||this;return i._time=0,i._auto=!1,i._shader=null,i._effect=null,i._shuriken=null,i.updateTime=!1,i.maximumTime=0,i._uniforms=[],i._samplers=[],i._textures={},i._textureArrays={},i._floats={},i._floatsArrays={},i._colors3={},i._colors4={},i._vectors2={},i._vectors3={},i._vectors4={},i._matrices={},i._matrices3x3={},i._matrices2x2={},i._vectors3Arrays={},i._time=0,i._auto=!1,i._effect=null,i._shuriken=null,i._shader=null,i.updateTime=!1,i.maximumTime=0,i.initializeParticleSystem(),i}return __extends(n,t),Object.defineProperty(n.prototype,"shuriken",{get:function(){return this._shuriken},enumerable:!0,configurable:!0}),n.prototype.start=function(){this.updateTime===!0&&this.setEffectTime(0),this._auto===!0&&null!=this._shuriken&&this._shuriken.start()},n.prototype.update=function(){this.updateTime===!0&&this.setEffectTime(this._time+this.manager.deltaTime)},n.prototype.destroy=function(){if(null!=this._effect&&(this._effect.onBind=null,this._effect=null),null!=this._shuriken){var t=this._shuriken;t._customEffect&&(t._customEffect=null),t=null,this._shuriken.dispose(),this._shuriken=null}if(null!=this._shader&&""!==this._shader){var n=this._shader+"FragmentShader";e.Effect.ShadersStore[n]&&delete e.Effect.ShadersStore[n]}},Object.defineProperty(n.prototype,"textures",{get:function(){return this._textures},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"textureArray",{get:function(){return this._textureArrays},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"floats",{get:function(){return this._floats},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"floatsArrays",{get:function(){return this._floatsArrays},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"colors3",{get:function(){return this._colors3},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"colors4",{get:function(){return this._colors4},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"vectors2",{get:function(){return this._vectors2},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"vectors3",{get:function(){return this._vectors3},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"vectors4",{get:function(){return this._vectors4},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"matrices",{get:function(){return this._matrices},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"matrices3x3",{get:function(){return this._matrices3x3},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"matrices2x2",{get:function(){return this._matrices2x2},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"vectors3Arrays",{get:function(){return this._vectors3Arrays},enumerable:!0,configurable:!0}),n.prototype.setTexture=function(e,t){return this._textures[e]=t,this},n.prototype.setTextureArray=function(e,t){return this._samplers.indexOf(e)===-1&&this._samplers.push(e),this._textureArrays[e]=t,this},n.prototype.setFloat=function(e,t){return this._floats[e]=t,this},n.prototype.setFloats=function(e,t){return this._floatsArrays[e]=t,this},n.prototype.setColor3=function(e,t){return this._colors3[e]=t,this},n.prototype.setColor4=function(e,t){return this._colors4[e]=t,this},n.prototype.setVector2=function(e,t){return this._vectors2[e]=t,this},n.prototype.setVector3=function(e,t){return this._vectors3[e]=t,this},n.prototype.setVector4=function(e,t){return this._vectors4[e]=t,this},n.prototype.setMatrix=function(e,t){return this._matrices[e]=t,this},n.prototype.setMatrix3x3=function(e,t){return this._matrices3x3[e]=t,this},n.prototype.setMatrix2x2=function(e,t){return this._matrices2x2[e]=t,this},n.prototype.setArray3=function(e,t){return this._vectors3Arrays[e]=t,this},n.prototype.getEffectTime=function(){return this._time},n.prototype.setEffectTime=function(e){this._time=e,this.maximumTime>0&&this._time>=this.maximumTime&&(this._time=0),this.setFloat("time",this._time)},n.prototype.bindParticleSystemEffect=function(e,t){var n;if(e.scene.texturesEnabled)for(n in e._textures){var a=e._textures[n];a&&(t.setTexture(n,a),t.setFloat2(n+"Infos",a.coordinatesIndex,a.level),t.setFloat2(n+"Scale",a.uScale,a.vScale),t.setMatrix(n+"Matrix",a.getTextureMatrix()))}if(e.scene.texturesEnabled)for(n in e._textureArrays)t.setTextureArray(n,e._textureArrays[n]);for(n in e._floats)t.setFloat(n,e._floats[n]);for(n in e._floatsArrays)t.setArray(n,e._floatsArrays[n]);for(n in e._colors3)t.setColor3(n,e._colors3[n]);for(n in e._colors4){var r=e._colors4[n];t.setFloat4(n,r.r,r.g,r.b,r.a)}for(n in e._vectors2)t.setVector2(n,e._vectors2[n]);for(n in e._vectors3)t.setVector3(n,e._vectors3[n]);for(n in e._vectors4)t.setVector4(n,e._vectors4[n]);for(n in e._matrices)t.setMatrix(n,e._matrices[n]);for(n in e._matrices3x3)t.setMatrix3x3(n,e._matrices3x3[n]);for(n in e._matrices2x2)t.setMatrix2x2(n,e._matrices2x2[n]);for(n in e._vectors3Arrays)t.setArray3(n,e._vectors3Arrays[n])},n.prototype.initializeParticleSystem=function(){this._auto=this.getProperty("autoStart",!1);var t=this.getProperty("capacity",100),n=this.getProperty("particleName",null),a=this.getProperty("startSpeed",.01),r=this.getProperty("emitType",0),i=this.getProperty("duration",10);null!=n&&""!==n||(n="PX_Unknown_"+e.Tools.RandomId());var o=this.getProperty("emitBurst",null),s=this.getProperty("ShurikenUpdateModules",null);null!=s&&(this.updateTime=s.updateEffectTime,this.maximumTime=s.maximumEffectTime);var l=this.getProperty("customShaderEffect",null);if(null!=l&&""!==l){var u=this,c=this.getProperty("customShaderDefines",null),p=this.getProperty("customShaderUniforms",null),h=this.getProperty("customShaderSamplers",null),d=null!=c&&c.length>0?c.join("\n"):null;this._shader="PX_"+this.mesh.name+"_"+n.replace("PX_","")+"_"+e.Tools.RandomId().replace(".","")+"_Effect";var m=l+"FragmentShader",f=this._shader+"FragmentShader";e.Effect.ShadersStore[f]=e.Effect.ShadersStore[m],this._effect=this.engine.createEffectForParticles(this._shader,p,h,d),this._effect.onBind=function(e){u.bindParticleSystemEffect(u,e)}}this._shuriken=new e.ShurikenParticleSystem(n,t,this.scene,i,r,a,o,s,this._effect),this._shuriken.emitter=this.mesh,this._shuriken.blendMode=this.getProperty("blendMode",0),this._shuriken.emitRate=this.getProperty("emitRate",100),this._shuriken.loopPlay=this.getProperty("loopPlay",!1),this._shuriken.delayTime=this.getProperty("delayTime",0);var g=this.getProperty("lifeTime"),y=e.Utilities.ParseVector2(g,new e.Vector2(1,1));this._shuriken.minLifeTime=y.x,this._shuriken.maxLifeTime=y.y;var _=this.getProperty("emitPower"),S=e.Utilities.ParseVector2(_,new e.Vector2(1,1));this._shuriken.minEmitPower=S.x,this._shuriken.maxEmitPower=S.y;var v=this.getProperty("angularSpeed"),M=e.Utilities.ParseVector2(v,new e.Vector2(0,0));this._shuriken.minAngularSpeed=M.x,this._shuriken.maxAngularSpeed=M.y;var b=this.getProperty("particleSize"),k=e.Utilities.ParseVector2(b,new e.Vector2(1,1));this._shuriken.minSize=k.x,this._shuriken.maxSize=k.y;var x=this.getProperty("color1");this._shuriken.color1=e.Utilities.ParseColor4(x,new e.Color4(1,1,1,1));var w=this.getProperty("color2");this._shuriken.color2=e.Utilities.ParseColor4(w,new e.Color4(1,1,1,1));var P=this.getProperty("colorDead");this._shuriken.colorDead=e.Utilities.ParseColor4(P,new e.Color4(0,0,0,1));var T=this.getProperty("textureMask");this._shuriken.textureMask=e.Utilities.ParseColor4(T,new e.Color4(1,1,1,1));var I=this.getProperty("direction1");this._shuriken.direction1=e.Utilities.ParseVector3(I,new e.Vector3(0,1,0));var C=this.getProperty("direction2");this._shuriken.direction2=e.Utilities.ParseVector3(C,new e.Vector3(0,1,0));var A=this.getProperty("minEmitBox");this._shuriken.minEmitBox=e.Utilities.ParseVector3(A,new e.Vector3(0,0,0));var O=this.getProperty("maxEmitBox");this._shuriken.maxEmitBox=e.Utilities.ParseVector3(O,new e.Vector3(0,0,0));var E=this.getProperty("gravityVector"),B=this.getProperty("gravityMode",0),L=this.getProperty("gravityMultiplier",1);1===B?this._shuriken.gravity=this.scene.gravity.multiplyByFloats(L,L,L):this._shuriken.gravity=e.Utilities.ParseVector3(E,new e.Vector3(0,0,0));var R=this.getProperty("textureImage",null);if(null!=R&&R.name&&""!==R.name){var D=R.name,N=this.manager.getScenePath();this._shuriken.particleTexture=new e.Texture(N+D,this.scene)}},n}(e.MeshComponent);e.UniversalParticleSystem=t}(BABYLON||(BABYLON={}));var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),BABYLON;!function(e){var t=function(t){
function n(n,a,r,i){void 0===r&&(r=!0),void 0===i&&(i={});var o=t.call(this,n,a,r,i)||this;return o.movementType=e.MovementType.DirectVelocity,o.avatarHeight=2,o.avatarRadius=.25,o.fallingVelocity=.1,o.slidingVelocity=.25,o.onPhysicsContact=null,o._jumping=!1,o._falling=!1,o._sliding=!1,o._grounded=!0,o._threashold=.5,o._velocity=e.Vector3.Zero(),o._angularVelocity=e.Vector3.Zero(),o._jumpingVelocity=e.Vector3.Zero(),o.movementType=o.getProperty("movementType",e.MovementType.DirectVelocity),o.avatarHeight=o.getProperty("avatarHeight",2),o.avatarRadius=o.getProperty("avatarRadius",.25),o.fallingVelocity=o.getProperty("fallingVelocity",.1),o.slidingVelocity=o.getProperty("slidingVelocity",.25),o}return __extends(n,t),n.prototype.isJumping=function(){return this._jumping},n.prototype.isFalling=function(){return this._falling},n.prototype.isSliding=function(){return this._sliding},n.prototype.isGrounded=function(){return this._grounded},n.prototype.getVelocity=function(){return this._velocity},n.prototype.getFriction=function(){return this.manager.getFrictionLevel(this.mesh)},n.prototype.setFriction=function(e){this.manager.applyFriction(this.mesh,e)},n.prototype.start=function(){var t=this;this._jumping=!1,this._falling=!1,this._sliding=!1,this._grounded=!0,this.updateGroundingState(),this.onCollisionEvent(function(n,a){t.manager.checkCollisionContact(t.mesh,n,e.CollisionContact.Bottom,t._threashold)===!0&&(t._jumping=!1,t.updateGroundingState()),null!=t.onPhysicsContact&&t.onPhysicsContact(n,a)})},n.prototype.update=function(){this.updateGroundingState()},n.prototype.after=function(){this.updateGroundingState()},n.prototype.updateGroundingState=function(){this._grounded=this._jumping===!1,this._velocity=this.manager.getLinearVelocity(this.mesh),this._falling=null!=this._velocity&&this._velocity.y<-this.fallingVelocity,this._sliding=this._grounded===!0&&null!=this._velocity&&this._velocity.y<-this.slidingVelocity},n.prototype.move=function(t,n,a){void 0===n&&(n=0),void 0===a&&(a=0),this.manager.applyFriction(this.mesh,n),this.movementType===e.MovementType.AppliedForces?this.manager.applyForce(this.mesh,t,this.mesh.getAbsolutePosition()):this.manager.setLinearVelocity(this.mesh,t),a>0&&(this._jumping=!0,this._jumpingVelocity.copyFromFloats(0,a,0),this.manager.applyImpulse(this.mesh,this._jumpingVelocity,this.mesh.getAbsolutePosition()),this.updateGroundingState())},n.prototype.rotate=function(e){this._angularVelocity.copyFromFloats(0,e,0),this.manager.setAngularVelocity(this.mesh,this._angularVelocity)},n}(e.MeshComponent);e.CharacterController=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(){}return t.Warning=function(t){e.Tools.Warn(t)},t.Loader=null,t}();e.ToolkitPlugin=t;var n=function(){function t(){this.name="toolkit.json",this.extensions={".babylon":{isBinary:!1}}}return t.prototype.load=function(t,n,a){var r=!1;return null!=e.ToolkitPlugin.Loader?(r=e.ToolkitPlugin.Loader.load(t,n,a,e.ToolkitPlugin.Warning),r===!0?e.SceneManager.parseSceneMetadata(a,t):e.Tools.Warn("Toolkit: Failed to load json scene data")):e.Tools.Warn("Toolkit: Null registered babylon file loader plugin"),r},t.prototype.importMesh=function(t,n,a,r,i,o,s){var l=!1;return null!=e.ToolkitPlugin.Loader?(l=e.ToolkitPlugin.Loader.importMesh(t,n,a,r,i,o,s,e.ToolkitPlugin.Warning),l===!0?e.SceneManager.parseMeshMetadata(i,n):e.Tools.Warn("Toolkit: Failed to load json scene data")):e.Tools.Warn("Toolkit: Null registered babylon file loader plugin"),l},t}();e.JsonSceneLoader=n;var a=function(){function t(){this.name="toolkit.binary",this.extensions={".bin":{isBinary:!0}}}return t.prototype.load=function(t,n,a){window.decoding=!0;var r=new Uint8Array(n),i=e.Utilities.DecompressToString(r);if(window.decoding=!1,null!=e.ToolkitPlugin.Loader){var o=e.ToolkitPlugin.Loader.load(t,i,a,e.ToolkitPlugin.Warning);o===!0?e.SceneManager.parseSceneMetadata(a,t):e.Tools.Warn("Toolkit: Failed to load binary scene data")}else e.Tools.Warn("Toolkit: Null registered babylon file loader plugin");return i=null,r=null,o},t.prototype.importMesh=function(t,n,a,r,i,o,s){window.decoding=!0;var l=new Uint8Array(a),u=e.Utilities.DecompressToString(l);if(window.decoding=!1,null!=e.ToolkitPlugin.Loader){var c=e.ToolkitPlugin.Loader.importMesh(t,n,u,r,i,o,s,e.ToolkitPlugin.Warning);c===!0?e.SceneManager.parseMeshMetadata(i,n):e.Tools.Warn("Toolkit: Failed to load json scene data")}else e.Tools.Warn("Toolkit: Null registered babylon file loader plugin");return u=null,l=null,c},t}();e.BinarySceneLoader=a}(BABYLON||(BABYLON={})),BABYLON.ToolkitPlugin.Loader=BABYLON.SceneLoader.GetPluginForExtension(".babylon"),BABYLON.SceneLoader.RegisterPlugin(new BABYLON.JsonSceneLoader),BABYLON.SceneLoader.RegisterPlugin(new BABYLON.BinarySceneLoader),BABYLON.Tools.Log("Toolkit: Scene manager loader plugins registered");var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),BABYLON;!function(e){var t=function(){function e(){this._defines={},this._defines={}}return e.prototype.getDefines=function(){return this._defines},e.prototype.resetDefines=function(){return this._defines={}},e.prototype.defineBoolean=function(e){this._defines[e]=!0},e.prototype.defineNumeric=function(e,t){this._defines[e]=t},e}();e.UniversalShaderDefines=t;var n=function(t){function n(e,n,a){void 0===a&&(a=!1);var r=t.call(this,e,n)||this;return r.ticking=!1,r._manager=null,r._started=!1,r._register=null,r._before=null,r._after=null,r._destroy=null,r.ticking=a,r.ticking&&r.initializeInstance(),r}return __extends(n,t),n.prototype.start=function(){},n.prototype.update=function(){},n.prototype.after=function(){},n.prototype.destroy=function(){},n.prototype.getManager=function(){return null==this._manager&&(this._manager=e.SceneManager.GetInstance()),this._manager},n.prototype.initializeInstance=function(){this._started=!1;var e=this;e._register=function(){e.registerInstance(e)},e._before=function(){e.updateInstance(e)},e._after=function(){e.afterInstance(e)},e._destroy=function(){e.destoryInstance(e)},e._register()},n.prototype.registerInstance=function(e){e.getScene().registerBeforeRender(e._before),e.getScene().registerAfterRender(e._after)},n.prototype.updateInstance=function(e){e._started?e.update():(e.start(),e._started=!0)},n.prototype.afterInstance=function(e){e._started&&e.after()},n.prototype.destoryInstance=function(e){e.getScene().unregisterBeforeRender(e._before),e.getScene().unregisterAfterRender(e._after),e.destroy(),e._started=!1,e._register=null,e._before=null,e._after=null,e._destroy=null},n.prototype.dispose=function(e,n){this._destroy(),t.prototype.dispose.call(this,e,n)},n}(e.PushMaterial);e.UniversalPushMaterial=n;var a=function(t){function n(n,a,r){void 0===r&&(r=!1);var i=t.call(this,n,a)||this;return i.tick=!0,i.ticking=!1,i.program="default",i._locals=null,i._uniforms=[],i._samplers=[],i._textures={},i._textureArrays={},i._floats={},i._floatsArrays={},i._colors3={},i._colors4={},i._vectors2={},i._vectors3={},i._vectors4={},i._matrices={},i._matrices3x3={},i._matrices2x2={},i._vectors3Arrays={},i._manager=null,i._started=!1,i._register=null,i._before=null,i._after=null,i._destroy=null,i.ticking=r,i._locals=new e.UniversalShaderDefines,i.customShaderNameResolve=i._buildCustomShader,i.ticking&&i.initializeInstance(),i}return __extends(n,t),n.prototype.start=function(){},n.prototype.update=function(){},n.prototype.define=function(e){},n.prototype.after=function(){},n.prototype.destroy=function(){},Object.defineProperty(n.prototype,"textures",{get:function(){return this._textures},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"textureArray",{get:function(){return this._textureArrays},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"floats",{get:function(){return this._floats},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"floatsArrays",{get:function(){return this._floatsArrays},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"colors3",{get:function(){return this._colors3},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"colors4",{get:function(){return this._colors4},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"vectors2",{get:function(){return this._vectors2},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"vectors3",{get:function(){return this._vectors3},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"vectors4",{get:function(){return this._vectors4},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"matrices",{get:function(){return this._matrices},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"matrices3x3",{get:function(){return this._matrices3x3},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"matrices2x2",{get:function(){return this._matrices2x2},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"vectors3Arrays",{get:function(){return this._vectors3Arrays},enumerable:!0,configurable:!0}),n.prototype.setTexture=function(e,t){return this._checkSampler(e),this._textures[e]=t,this},n.prototype.setTextureArray=function(e,t){return this._samplers.indexOf(e)===-1&&this._samplers.push(e),this._checkUniform(e),this._textureArrays[e]=t,this},n.prototype.setFloat=function(e,t){return this._checkUniform(e),this._floats[e]=t,this},n.prototype.setFloats=function(e,t){return this._checkUniform(e),this._floatsArrays[e]=t,this},n.prototype.setColor3=function(e,t){return this._checkUniform(e),this._colors3[e]=t,this},n.prototype.setColor4=function(e,t){return this._checkUniform(e),this._colors4[e]=t,this},n.prototype.setVector2=function(e,t){return this._checkUniform(e),this._vectors2[e]=t,this},n.prototype.setVector3=function(e,t){return this._checkUniform(e),this._vectors3[e]=t,this},n.prototype.setVector4=function(e,t){return this._checkUniform(e),this._vectors4[e]=t,this},n.prototype.setMatrix=function(e,t){return this._checkUniform(e),this._matrices[e]=t,this},n.prototype.setMatrix3x3=function(e,t){return this._checkUniform(e),this._matrices3x3[e]=t,this},n.prototype.setMatrix2x2=function(e,t){return this._checkUniform(e),this._matrices2x2[e]=t,this},n.prototype.setArray3=function(e,t){return this._checkUniform(e),this._vectors3Arrays[e]=t,this},n.prototype.isReadyForSubMesh=function(e,n,a){this._locals.resetDefines(),this.define(this._locals);var r=!1,i=this.getScene();if(i.texturesEnabled){var o,s=!0;for(o in this._textures){var l=this._textures[o];l&&l.isReadyOrNotBlocking()?(r=!0,this._locals.defineBoolean(o+"Def"),this._checkUniform(o+"Infos"),this._checkUniform(o+"Scale"),this._checkUniform(o+"Matrix")):s=!1}if(!s)return!1;s=!0;for(o in this._textureArrays){this._locals.defineBoolean(o+"Def");for(var u=this._textureArrays[o],c=0;c<u.length;c++){var p=u[c];p&&p.isReadyOrNotBlocking()?r=!0:s=!1}}if(!s)return!1}return t.prototype.isReadyForSubMesh.call(this,e,n,a)},n.prototype.getAnimatables=function(){var e,n=t.prototype.getAnimatables.call(this);for(e in this._textures){var a=this._textures[e];a&&n.push(a)}for(e in this._textureArrays)for(var r=this._textureArrays[e],i=0;i<r.length;i++){var a=r[i];a&&n.push(a)}return n},n.prototype.getActiveTextures=function(){var e,n=t.prototype.getActiveTextures.call(this);for(e in this._textures){var a=this._textures[e];a&&n.push(a)}for(e in this._textureArrays)for(var r=this._textureArrays[e],i=0;i<r.length;i++){var a=r[i];a&&n.push(a)}return n},n.prototype.hasTexture=function(e){if(t.prototype.hasTexture.call(this,e))return!0;var n,a=!1;for(n in this._textures){var r=this._textures[n];if(r&&r===e){a=!0;break}}if(a===!1)for(n in this._textureArrays){for(var i=this._textureArrays[n],o=0;o<i.length;o++){var s=i[o];if(s&&s===e){a=!0;break}}if(a===!0)break}return a},n.prototype.clone=function(t){var n=this,a=e.SerializationHelper.Clone(function(){return new e.UniversalShaderMaterial(t,n.getScene())},this);return e.UniversalShaderMaterial.CloneCustomProperties(this,a),a},n.prototype.serialize=function(){var t=e.SerializationHelper.Serialize(this);return t.customType="BABYLON.UniversalShaderMaterial",e.UniversalShaderMaterial.SerializeCustomProperties(this,t),t},n.Parse=function(t,n,a){var r=e.SerializationHelper.Parse(function(){return new e.UniversalShaderMaterial(t.name,n)},t,n,a);return e.UniversalShaderMaterial.ParseCustomProperties(r,t,n,a),r},n.CloneCustomProperties=function(e,t){if(null!=e&&null!=t){var n;t._textures={};for(n in e._textures){var a=e._textures[n];a&&t.setTexture(n,a.clone())}t._textureArrays={};for(n in e._textureArrays){t._textureArrays[n]=[];for(var r=e._textureArrays[n],i=new Array,o=0;o<r.length;o++)i.push(r[o].clone());t.setTextureArray(n,i)}t._floats={};for(n in e._floats)t.setFloat(n,e._floats[n]);t._floatsArrays={};for(n in e._floatsArrays)t.setFloats(n,e._floatsArrays[n]);t._colors3={};for(n in e._colors3)t.setColor3(n,e._colors3[n].clone());t._colors4={};for(n in e._colors4)t.setColor4(n,e._colors4[n].clone());t._vectors2={};for(n in e._vectors2)t.setVector2(n,e._vectors2[n].clone());t._vectors3={};for(n in e._vectors3)t.setVector3(n,e._vectors3[n].clone());t._vectors4={};for(n in e._vectors4)t.setVector4(n,e._vectors4[n].clone());t._matrices={};for(n in e._matrices)t.setMatrix(n,e._matrices[n].clone());t._matrices3x3={};for(n in e._matrices3x3)t.setMatrix3x3(n,e._matrices3x3[n]);t._matrices2x2={};for(n in e._matrices2x2)t.setMatrix2x2(n,e._matrices2x2[n]);t._vectors3Arrays={};for(n in e._vectors3Arrays)t.setArray3(n,e._vectors3Arrays[n])}},n.SerializeCustomProperties=function(e,t){if(null!=t&&null!=e){var n;t.textures={};for(n in e._textures){var a=e._textures[n];a&&(t.textures[n]=a.serialize())}t.textureArrays={};for(n in e._textureArrays){t.textureArrays[n]=[];for(var r=e._textureArrays[n],i=0;i<r.length;i++)t.textureArrays[n].push(r[i].serialize())}t.floats={};for(n in e._floats)t.floats[n]=e._floats[n];t.floatsArrays={};for(n in e._floatsArrays)t.floatsArrays[n]=e._floatsArrays[n];t.colors3={};for(n in e._colors3)t.colors3[n]=e._colors3[n].asArray();t.colors4={};for(n in e._colors4)t.colors4[n]=e._colors4[n].asArray();t.vectors2={};for(n in e._vectors2)t.vectors2[n]=e._vectors2[n].asArray();t.vectors3={};for(n in e._vectors3)t.vectors3[n]=e._vectors3[n].asArray();t.vectors4={};for(n in e._vectors4)t.vectors4[n]=e._vectors4[n].asArray();t.matrices={};for(n in e._matrices)t.matrices[n]=e._matrices[n].asArray();t.matrices3x3={};for(n in e._matrices3x3)t.matrices3x3[n]=e._matrices3x3[n];t.matrices2x2={};for(n in e._matrices2x2)t.matrices2x2[n]=e._matrices2x2[n];t.vectors3Arrays={};for(n in e._vectors3Arrays)t.vectors3Arrays[n]=e._vectors3Arrays[n]}},n.ParseCustomProperties=function(t,n,a,r){if(null!=n&&null!=t){var i;for(i in n.textures){var o=n.textures[i];o&&t.setTexture(i,e.Texture.Parse(o,a,r))}for(i in n.textureArrays){for(var s=n.textureArrays[i],l=new Array,u=0;u<s.length;u++)l.push(e.Texture.Parse(s[u],a,r));t.setTextureArray(i,l)}for(i in n.floats)t.setFloat(i,n.floats[i]);for(i in n.floatsArrays)t.setFloats(i,n.floatsArrays[i]);for(i in n.colors3)t.setColor3(i,e.Color3.FromArray(n.colors3[i]));for(i in n.colors4)t.setColor4(i,e.Color4.FromArray(n.colors4[i]));for(i in n.vectors2)t.setVector2(i,e.Vector2.FromArray(n.vectors2[i]));for(i in n.vectors3)t.setVector3(i,e.Vector3.FromArray(n.vectors3[i]));for(i in n.vectors4)t.setVector4(i,e.Vector4.FromArray(n.vectors4[i]));for(i in n.matrices)t.setMatrix(i,e.Matrix.FromArray(n.matrices[i]));for(i in n.matrices3x3)t.setMatrix3x3(i,n.matrices3x3[i]);for(i in n.matrices2x2)t.setMatrix2x2(i,n.matrices2x2[i]);for(i in n.vectors3Arrays)t.setArray3(i,n.vectors3Arrays[i])}},n.prototype.getManager=function(){return null==this._manager&&(this._manager=e.SceneManager.GetInstance()),this._manager},n.prototype._checkUniform=function(e){this._uniforms.indexOf(e)===-1&&this._uniforms.push(e)},n.prototype._checkSampler=function(e){this._samplers.indexOf(e)===-1&&this._samplers.push(e)},n.prototype._buildCustomShader=function(e,t,n,a,r){var i=this;null!=this.program&&""!==this.program||(this.program="default");var o=this._locals.getDefines();if(null!=o){var s=Object.keys(o);if(null!=s&&s.length>0){for(var l=r,u=0,c=s;u<c.length;u++){var p=c[u];l[p]=o[p]}r.rebuild()}}var h=0;if(null!=this._uniforms&&this._uniforms.length>0)for(h=0;h<this._uniforms.length;h++)t.push(this._uniforms[h]);if(h=0,null!=this._samplers&&this._samplers.length>0)for(h=0;h<this._samplers.length;h++)a.push(this._samplers[h]);var d=this._afterBind;return this._afterBind=function(e,t){if(i._attachAfterBind(e,t),d)try{d(e,t)}catch(n){}},this.program},n.prototype._attachAfterBind=function(e,t){var n,a=this.getScene();if(a.texturesEnabled)for(n in this._textures){var r=this._textures[n];r&&(t.setTexture(n,r),t.setFloat2(n+"Infos",r.coordinatesIndex,r.level),t.setFloat2(n+"Scale",r.uScale,r.vScale),t.setMatrix(n+"Matrix",r.getTextureMatrix()))}if(a.texturesEnabled)for(n in this._textureArrays)t.setTextureArray(n,this._textureArrays[n]);for(n in this._floats)t.setFloat(n,this._floats[n]);for(n in this._floatsArrays)t.setArray(n,this._floatsArrays[n]);for(n in this._colors3)t.setColor3(n,this._colors3[n]);for(n in this._colors4){var i=this._colors4[n];t.setFloat4(n,i.r,i.g,i.b,i.a)}for(n in this._vectors2)t.setVector2(n,this._vectors2[n]);for(n in this._vectors3)t.setVector3(n,this._vectors3[n]);for(n in this._vectors4)t.setVector4(n,this._vectors4[n]);for(n in this._matrices)t.setMatrix(n,this._matrices[n]);for(n in this._matrices3x3)t.setMatrix3x3(n,this._matrices3x3[n]);for(n in this._matrices2x2)t.setMatrix2x2(n,this._matrices2x2[n]);for(n in this._vectors3Arrays)t.setArray3(n,this._vectors3Arrays[n])},n.prototype.initializeInstance=function(){this._started=!1;var e=this;e._register=function(){e.registerInstance(e)},e._before=function(){e.updateInstance(e)},e._after=function(){e.afterInstance(e)},e._destroy=function(){e.destoryInstance(e)},e._register()},n.prototype.registerInstance=function(e){e.getScene().registerBeforeRender(e._before),e.getScene().registerAfterRender(e._after)},n.prototype.updateInstance=function(e){e._started?e.update():(e.start(),e._started=!0)},n.prototype.afterInstance=function(e){e._started&&e.after()},n.prototype.destoryInstance=function(e){e.getScene().unregisterBeforeRender(e._before),e.getScene().unregisterAfterRender(e._after),e.destroy(),e._started=!1,e._register=null,e._before=null,e._after=null,e._destroy=null},n.prototype.dispose=function(e,n){if(n){var a;for(a in this._textures){var r=this._textures[a];r&&r.dispose(),this._textures[a]=null}for(a in this._textureArrays)for(var i=this._textureArrays[a],o=0;o<i.length;o++)i[o].dispose()}this._textures={},this._destroy(),t.prototype.dispose.call(this,e,n)},n}(e.StandardMaterial);e.UniversalShaderMaterial=a;var r=function(t){function n(e,n,a){void 0===a&&(a=!1);var r=t.call(this,e,n,a)||this;return r.program="splatmap",r}return __extends(n,t),n.prototype.clone=function(t){var n=this,a=e.SerializationHelper.Clone(function(){return new e.UniversalTerrainMaterial(t,n.getScene())},this);return e.UniversalShaderMaterial.CloneCustomProperties(this,a),a},n.prototype.serialize=function(){var t=e.SerializationHelper.Serialize(this);return t.customType="BABYLON.UniversalTerrainMaterial",e.UniversalShaderMaterial.SerializeCustomProperties(this,t),t},n.Parse=function(t,n,a){var r=e.SerializationHelper.Parse(function(){return new e.UniversalTerrainMaterial(t.name,n)},t,n,a);return e.UniversalShaderMaterial.ParseCustomProperties(r,t,n,a),r},n}(e.UniversalShaderMaterial);e.UniversalTerrainMaterial=r}(BABYLON||(BABYLON={}));var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),BABYLON;!function(e){var t=function(t){function n(a,r,i,o,s,l,u,c,p){void 0===o&&(o=0),void 0===s&&(s=n.EMISSION_RATE),void 0===l&&(l=.01),void 0===u&&(u=null),void 0===c&&(c=null),void 0===p&&(p=null);var h=t.call(this,a,r,i,p)||this;return h.emitType=n.EMISSION_RATE,h.loopPlay=!1,h.delayTime=0,h._duration=0,h._startSpeed=-1,h._enableTime=!1,h._cycleHandler=null,h._emissionBurst=null,h._updateModules=null,h._duration=o,h._startSpeed=l,h._emissionBurst=u,h._updateModules=null!=c?c:new e.ShurikenUpdateModules,h.delayTime=0,h.loopPlay=!1,h.emitType=s,h.updateSpeed=l,h.disposeOnStop=!1,h.preventAutoStart=!0,h.targetStopDuration=0,h.updateFunction=h.defaultUpdateOverTimeFunctionHandler,h.startPositionFunction=h.defaultStartPositionFunctionHandler,h.startDirectionFunction=h.defaultStartDirectionFunctionHandler,h.manualEmitCount=h.emitType===n.EMISSION_BURST?0:-1,h}return __extends(n,t),Object.defineProperty(n,"EMISSION_RATE",{get:function(){return 0},enumerable:!0,configurable:!0}),Object.defineProperty(n,"EMISSION_BURST",{get:function(){return 1},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"modules",{get:function(){return this._updateModules},enumerable:!0,configurable:!0}),n.prototype.start=function(){var e=this;if(this.internalStop(!1),this.updateSpeed=this._startSpeed,this.disposeOnStop=!1,this.preventAutoStart=!0,this.targetStopDuration=0,this.emitType===n.EMISSION_BURST?null!=this._emissionBurst&&this._emissionBurst.length>0&&this._emissionBurst.forEach(function(t){e.internalPlay(e.delayTime+t.time,t.minCount,t.maxCount)}):this.internalPlay(this.delayTime),this._duration>0){var t=this.delayTime+this._duration;if(null!=this._updateModules&&this._updateModules.updateOverTime===!0&&null!=this.animations&&this.animations.length>0){var a=t*this._updateModules.framesPerSecond;this._cycleHandler=this.internalScene.beginAnimation(this,0,a,!1,1)}window.setTimeout(function(){e.internalCycle()},1e3*t)}},n.prototype.stop=function(){this.internalStop(!0)},n.prototype.dispose=function(){this.internalStop(!0),this._emissionBurst=null,this._updateModules=null,this.updateFunction=null,this.startPositionFunction=null,this.startDirectionFunction=null,t.prototype.dispose.call(this)},Object.defineProperty(n.prototype,"internalScene",{get:function(){return this._scene},enumerable:!0,configurable:!0}),n.prototype.internalPlay=function(e,t,n){var a=this;void 0===e&&(e=0),void 0===t&&(t=-1),void 0===n&&(n=-1),e>0?window.setTimeout(function(){a.internalStart(t,n)},1e3*e):this.internalStart(t,n)},n.prototype.internalCycle=function(){this.stop(),this.loopPlay===!0&&this.start()},n.prototype.internalStart=function(a,r){var i=this.emitType===n.EMISSION_BURST?0:-1;this.emitType===n.EMISSION_BURST&&a>=1&&r>=1&&(i=e.Scalar.RandomRange(a,r)),this.manualEmitCount=i,t.prototype.start.call(this)},n.prototype.internalStop=function(e){if(void 0===e&&(e=!1),null!=this._cycleHandler&&(this._cycleHandler.stop(),this._cycleHandler=null),e===!1){var n=this;null!=n&&n._started&&!n._stopped&&t.prototype.stop.call(this)}else t.prototype.stop.call(this)},n.prototype.getParticles=function(){return this.particles},Object.defineProperty(n.prototype,"stockParticles",{get:function(){return this._stockParticles},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scaledUpdateSpeed",{get:function(){return this._scaledUpdateSpeed},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scaledDirection",{get:function(){return this._scaledDirection},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scaledColorStep",{get:function(){return this._scaledColorStep},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scaledGravity",{get:function(){return this._scaledGravity},enumerable:!0,configurable:!0}),n.prototype.recycleParticle=function(e){null!=this._updateModules,t.prototype.recycleParticle.call(this,e)},n.prototype.defaultStartDirectionFunctionHandler=function(t,n,a,r){null!=this._updateModules;var i=e.Scalar.RandomRange(this.direction1.x,this.direction2.x),o=e.Scalar.RandomRange(this.direction1.y,this.direction2.y),s=e.Scalar.RandomRange(this.direction1.z,this.direction2.z);e.Vector3.TransformNormalFromFloatsToRef(i*t,o*t,s*t,n,a)},n.prototype.defaultStartPositionFunctionHandler=function(t,n,a){null!=this._updateModules;var r=e.Scalar.RandomRange(this.minEmitBox.x,this.maxEmitBox.x),i=e.Scalar.RandomRange(this.minEmitBox.y,this.maxEmitBox.y),o=e.Scalar.RandomRange(this.minEmitBox.z,this.maxEmitBox.z);e.Vector3.TransformCoordinatesFromFloatsToRef(r,i,o,t,n)},n.prototype.defaultUpdateOverTimeFunctionHandler=function(e){null!=this._updateModules;for(var t=0;t<e.length;t++){var n=e[t];n.age+=this.scaledUpdateSpeed,n.age>=n.lifeTime?(this.recycleParticle(n),t--):(n.colorStep.scaleToRef(this.scaledUpdateSpeed,this.scaledColorStep),n.color.addInPlace(this.scaledColorStep),n.color.a<0&&(n.color.a=0),n.angle+=n.angularSpeed*this.scaledUpdateSpeed,n.direction.scaleToRef(this.scaledUpdateSpeed,this.scaledDirection),n.position.addInPlace(this.scaledDirection),this.gravity.scaleToRef(this.scaledUpdateSpeed,this.scaledGravity),n.direction.addInPlace(this.scaledGravity))}},n}(e.ParticleSystem);e.ShurikenParticleSystem=t;var n=function(){function e(){this.updateOverTime=!1,this.framesPerSecond=30,this.speedModule=null,this.emissionModule=null,this.velocityModule=null,this.colorModule=null,this.sizingModule=null,this.rotationModule=null,this.updateEffectTime=!1,this.maximumEffectTime=0}return e}();e.ShurikenUpdateModules=n}(BABYLON||(BABYLON={}));var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),BABYLON;!function(e){var t=function(t){function n(n,a,r,i){void 0===r&&(r=!0),void 0===i&&(i={});var o=t.call(this,n,a,r,i)||this;if(o._state=null,o._speed=1,o._entry=null,o._machine=null,o._enabled=!1,o._handlers=null,o._blending=0,o._autoplay=!1,o._executed=!1,o._checkers=new e.TransitionCheck,o._rootSpeed=0,o._rootRotation=0,o._rootVelocity=e.Vector3.Zero(),o.autoTicking=!0,o.onStateChanged=null,o._state=null,o._entry=null,o._handlers={},o._machine=null,o._executed=!1,o._enabled=o.getProperty("enableStateMachine",!1),o._blending=o.getProperty("defaultBlending",0),o._autoplay=o.getProperty("automaticPlay",!1),null!=o.owned.metadata&&(o.owned.metadata.state={},o.owned.metadata.state.floats={},o.owned.metadata.state.booleans={},o.owned.metadata.state.triggers={},o.owned.metadata.state.parameters={},null!=o.owned.metadata.properties&&null!=o.owned.metadata.properties.stateMachineInfo&&(o._machine=o.owned.metadata.properties.stateMachineInfo,null!=o._machine&&(null!=o._machine.speed&&(o._speed=o._machine.speed),null!=o._machine.entry&&""!==o._machine.entry&&(o._entry=o._machine.entry),null!=o._machine.parameters&&o._machine.parameters.length>0)))){var s=o._machine.parameters;s.forEach(function(t){var n=t.name,a=t.type,r=(t.curve,t.defaultFloat),i=t.defaultBool,s=t.defaultInt;o.owned.metadata.state.parameters[n]=a,a===e.AnimatorParameterType.Float?o.setNumber(n,r):a===e.AnimatorParameterType.Int?o.setNumber(n,s):a===e.AnimatorParameterType.Bool?o.setBoolean(n,i):a===e.AnimatorParameterType.Trigger&&o.resetTrigger(n)})}return o}return __extends(n,t),Object.defineProperty(n.prototype,"executing",{get:function(){return this._executed},enumerable:!0,configurable:!0}),n.prototype.start=function(){this.startStateMachine()},n.prototype.update=function(){this.autoTicking===!0&&this.updateStateMachine()},n.prototype.destroy=function(){this.destroyStateMachine()},n.prototype.tickStateMachine=function(){this.autoTicking===!1?this.updateStateMachine():e.Tools.Warn("Manual tick request ignored. Auto ticking is enabled for animator: "+this.owned.name)},n.prototype.getNumber=function(e){var t=0;return null!=this.owned.metadata&&null!=this.owned.metadata.state&&null!=this.owned.metadata.state.floats&&null!=this.owned.metadata.state.floats[e]&&(t=this.owned.metadata.state.floats[e]),t},n.prototype.setNumber=function(e,t){null!=this.owned.metadata&&null!=this.owned.metadata.state&&null!=this.owned.metadata.state.floats&&(this.owned.metadata.state.floats[e]=t)},n.prototype.getBoolean=function(e){var t=!1;return null!=this.owned.metadata&&null!=this.owned.metadata.state&&null!=this.owned.metadata.state.booleans&&null!=this.owned.metadata.state.booleans[e]&&(t=this.owned.metadata.state.booleans[e]),t},n.prototype.setBoolean=function(e,t){null!=this.owned.metadata&&null!=this.owned.metadata.state&&null!=this.owned.metadata.state.booleans&&(this.owned.metadata.state.booleans[e]=t)},n.prototype.getTrigger=function(e){var t=!1;return null!=this.owned.metadata&&null!=this.owned.metadata.state&&null!=this.owned.metadata.state.triggers&&null!=this.owned.metadata.state.triggers[e]&&(t=this.owned.metadata.state.triggers[e]),t},n.prototype.setTrigger=function(e){null!=this.owned.metadata&&null!=this.owned.metadata.state&&null!=this.owned.metadata.state.triggers&&(this.owned.metadata.state.triggers[e]=!0)},n.prototype.resetTrigger=function(e){null!=this.owned.metadata&&null!=this.owned.metadata.state&&null!=this.owned.metadata.state.triggers&&(this.owned.metadata.state.triggers[e]=!1)},n.prototype.getCurrentState=function(){return this._state},n.prototype.setCurrentState=function(e,t){void 0===t&&(t=0),this.setCurrentMachineState(e,t)},n.prototype.onAnimationEvent=function(e,t){null!=e&&""!==e&&(this._handlers[e.toLowerCase()]=t)},n.prototype.getAnimationEventHandler=function(e){var t=null;if(null!=e&&""!==e){var n=this._handlers[e.toLowerCase()];null!=n&&(t=n)}return t},n.prototype.getRootMotionSpeed=function(){return this._rootSpeed},n.prototype.getRootMotionRotation=function(){return this._rootRotation},n.prototype.getRootMotionVelocity=function(){return this._rootVelocity},n.prototype.startStateMachine=function(){this._executed===!1&&(this._executed=!0,this._enabled===!0?this._autoplay===!0&&null!=this._entry&&""!==this._entry&&this.setCurrentMachineState(this._entry,0):this._autoplay===!0&&this.manager.playAnimationClip(null,this.owned))},n.prototype.updateStateMachine=function(){var t=this;this._checkers.result=null,this._checkers.offest=0,this._checkers.blending=0,this._checkers.triggered=[],null!=this._state&&(this.checkStateTransitions(this._state.transitions,this._state.time,this._state.length,this._state.rate,this._state.index),null==this._checkers.result&&null!=this._machine.transitions&&this.checkStateTransitions(this._machine.transitions,this._state.time,this._state.length,this._state.rate,this._state.index),null==this._checkers.result&&this._state.type===e.MotionType.Tree&&this.updateBlendingTree()),this.validateRootMotion(),null!=this._checkers.triggered&&this._checkers.triggered.length>0&&(this._checkers.triggered.forEach(function(e){t.resetTrigger(e)}),this._checkers.triggered=null),null!=this._checkers.result&&(this._checkers.offest>0?this.manager.delay(function(){t.setCurrentMachineState(t._checkers.result,t._checkers.blending)},1e3*this._checkers.offest):this.setCurrentMachineState(this._checkers.result,this._checkers.blending))},n.prototype.checkStateTransitions=function(t,n,a,r,i){var o=this;if(null!=t&&t.length>0){var s=0;for(s=0;s<t.length;s++){var l=t[s];if(l.indexLayer===i&&l.mute!==!0){var u=!1,c=e.Scalar.Denormalize(l.exitTime,0,a),p=this.manager.time-n>=c;if(l.hasExitTime!==!0||l.intSource!=e.InterruptionSource.None||p!==!1){if(null!=l.conditions&&l.conditions.length>0){var h=0,d=l.conditions.length;l.conditions.forEach(function(t){if(null!=o.owned.metadata.state.parameters[t.parameter]){var n=o.owned.metadata.state.parameters[t.parameter];
if(n==e.AnimatorParameterType.Float||n==e.AnimatorParameterType.Int){var a=o.getNumber(t.parameter);t.mode===e.ConditionMode.Greater&&a>t.threshold?h++:t.mode===e.ConditionMode.Less&&a<t.threshold?h++:t.mode===e.ConditionMode.Equals&&a===t.threshold?h++:t.mode===e.ConditionMode.NotEqual&&a!==t.threshold&&h++}else if(n==e.AnimatorParameterType.Bool){var r=o.getBoolean(t.parameter);t.mode===e.ConditionMode.If&&r===!0?h++:t.mode===e.ConditionMode.IfNot&&r===!1&&h++}else if(n==e.AnimatorParameterType.Trigger){var i=o.getTrigger(t.parameter);i===!0&&(h++,o._checkers.triggered.indexOf(t.parameter)<0&&o._checkers.triggered.push(t.parameter))}}}),u=l.hasExitTime===!0?p===!0&&h===d:h===d}else u=l.hasExitTime===!0&&p===!0;if(u===!0){var m=l.isExit===!1?l.destination:e.AnimationState.EXIT,f=e.Scalar.Denormalize(l.offset,0,a),g=e.Scalar.Denormalize(l.duration,0,a),y=e.Utilities.ComputeBlendingSpeed(r,g);this._checkers.result=m,this._checkers.offest=f,this._checkers.blending=y;break}}}}}},n.prototype.getMachineStateInfo=function(e){var t=0,n=null;if(null!=this._machine&&null!=this._machine.states&&this._machine.states.length>0){var a=this._machine.states,r=this._machine.states.length;for(t=0;t<r;t++){var i=a[t];if(null!=i&&i.name===e){n=i;break}}}return n},n.prototype.setCurrentMachineState=function(t,n){null!=t&&""!==t&&t!==e.AnimationState.EXIT&&(null!=this._state&&this._state.name===t||(this.resetMachineState(this._state),this._state=this.getMachineStateInfo(t),null!=this._state&&(this._state.time=this.manager.time,this._state.type===e.MotionType.Clip&&null!=this._state.motion&&""!==this._state.motion&&(this._state.animations=this.manager.playAnimationClip(this._state.motion,this.owned,n,this._state.speed*this._speed,!0)),null!=this.onStateChanged&&this.onStateChanged())))},n.prototype.resetMachineState=function(e){null!=e&&(e.time=0,e.branch=null,e.animations=null,e.interupted=!1)},n.prototype.destroyStateMachine=function(){this.resetMachineState(this._state),this.onStateChanged=null,null!=this.owned.metadata&&null!=this.owned.metadata.state&&(this.owned.metadata.state=null),this._state=null},n.prototype.updateBlendingTree=function(){if(null!=this._state&&null!=this._state.blendtree){var e=this.getBlendTreeBranch(this._state.blendtree);null!=e&&null!=e.motion&&""!==e.motion&&this._state.branch!==e.motion&&(this._state.branch=e.motion,this._state.animations=this.manager.playAnimationClip(e.motion,this.owned,this._blending,e.timescale*this._state.speed*this._speed,!0))}},n.prototype.getBlendTreeBranch=function(t){var n=null;if(null!=t.children&&t.children.length>0){var a=0,r=this.getNumber(t.blendParameterX),i=this.getNumber(t.blendParameterY);for(a=0;a<t.children.length;a++){var o=!1,s=t.children[a];if(this._state.blendtree.blendType===e.BlendTreeType.Simple1D?o=r===s.threshold:null!=s.position&&s.position.length>=2&&(o=r===s.position[0]&&i===s.position[1]),o===!0&&(n=s.type===e.MotionType.Tree?this.getBlendTreeBranch(s.subtree):s),null!=n)break}}return n},n.prototype.validateRootMotion=function(){null!=this._state&&null!=this._state.averageSpeed&&this._state.averageSpeed.length>=3?(this._rootSpeed=this._state.averageSpeed[2],this._rootRotation=this._state.averageAngularSpeed,this._rootVelocity.copyFromFloats(this._state.averageSpeed[0],this._state.averageSpeed[1],this._state.averageSpeed[2])):(this._rootSpeed=0,this._rootRotation=0,this._rootVelocity.copyFromFloats(0,0,0))},n.EXIT="[EXIT]",n}(e.SceneComponent);e.AnimationState=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(){}return t.Angle=function(t,n){return 57.29578*Math.acos(e.Scalar.Clamp(e.Vector3.Dot(t.normalize(),n.normalize()),-1,1))},t.Euler=function(t,n,a){return e.Quaternion.RotationYawPitchRoll(n,t,a)},t.EulerToRef=function(t,n,a,r){e.Quaternion.RotationYawPitchRollToRef(n,t,a,r)},t.Matrix=function(t,n,a){return e.Matrix.RotationYawPitchRoll(n,t,a)},t.MatrixToRef=function(t,n,a,r){e.Matrix.RotationYawPitchRollToRef(n,t,a,r)},t.ClampAngle=function(t,n,a){var r=t;do r<-360&&(r+=360),r>360&&(r-=360);while(r<-360||r>360);return e.Scalar.Clamp(r,n,a)},t.RotateVector=function(t,n){var a=2*(n.y*t.z-n.z*t.y),r=2*(n.z*t.x-n.x*t.z),i=2*(n.x*t.y-n.y*t.x);return new e.Vector3(t.x+n.w*a+(n.y*i-n.z*r),t.y+n.w*r+(n.z*a-n.x*i),t.z+n.w*i+(n.x*r-n.y*a))},t.RotateVectorToRef=function(e,t,n){var a=2*(t.y*e.z-t.z*e.y),r=2*(t.z*e.x-t.x*e.z),i=2*(t.x*e.y-t.y*e.x);n.x=e.x+t.w*a+(t.y*i-t.z*r),n.y=e.y+t.w*r+(t.z*a-t.x*i),n.z=e.z+t.w*i+(t.x*r-t.y*a)},t.MoveTowardsVector=function(e,t,n){var a,r=t.subtract(e),i=r.length();return(i<=n||0===i)&&(a=t),a},t.MoveTowardsAngle=function(t,n,a){var r,i=e.Scalar.DeltaAngle(t,n);return-a<i&&i<a?r=n:(n=t+i,r=e.Scalar.MoveTowards(t,n,a)),r},t.TransformPosition=function(t,n){return e.Vector3.TransformCoordinates(n,t.getWorldMatrix())},t.TransformPositionToRef=function(t,n,a){return e.Vector3.TransformCoordinatesToRef(n,t.getWorldMatrix(),a)},t.TransformDirection=function(t,n){return e.Vector3.TransformNormal(n,t.getWorldMatrix())},t.TransformDirectionToRef=function(t,n,a){return e.Vector3.TransformNormalToRef(n,t.getWorldMatrix(),a)},t.GetDirectionVector=function(e,t){return e.getDirection(t)},t.GetDirectionVectorToRef=function(e,t,n){e.getDirectionToRef(t,n)},t.GetForwardVector=function(t){return t.getDirection(e.Vector3.Forward())},t.GetForwardVectorToRef=function(t,n){t.getDirectionToRef(e.Vector3.Forward(),n)},t.GetRightVector=function(t){return t.getDirection(e.Vector3.Right())},t.GetRightVectorToRef=function(t,n){t.getDirectionToRef(e.Vector3.Right(),n)},t.GetUpVector=function(t){return t.getDirection(e.Vector3.Up())},t.GetUpVectorToRef=function(t,n){t.getDirectionToRef(e.Vector3.Up(),n)},t.GetQuaternionForwardVector=function(t){return new e.Vector3(2*(t.x*t.z+t.w*t.y),2*(t.y*t.x-t.w*t.x),1-2*(t.x*t.x+t.y*t.y))},t.GetQuaternionForwardVectorToRef=function(e,t){null!=t&&(t.x=2*(e.x*e.z+e.w*e.y),t.y=2*(e.y*e.x-e.w*e.x),t.z=1-2*(e.x*e.x+e.y*e.y))},t.GetQuaternionRightVector=function(t){return new e.Vector3(1-2*(t.y*t.y+t.z*t.z),2*(t.x*t.y+t.w*t.z),2*(t.x*t.z-t.w*t.y))},t.GetQuaternionRightVectorToRef=function(e,t){null!=t&&(t.x=1-2*(e.y*e.y+e.z*e.z),t.y=2*(e.x*e.y+e.w*e.z),t.z=2*(e.x*e.z-e.w*e.y))},t.GetQuaternionUpVector=function(t){return new e.Vector3(2*(t.x*t.y-t.w*t.z),1-2*(t.x*t.x+t.z*t.z),2*(t.y*t.z+t.w*t.x))},t.GetQuaternionUpVectorToRef=function(e,t){null!=t&&(t.x=2*(e.x*e.y-e.w*e.z),t.y=1-2*(e.x*e.x+e.z*e.z),t.z=2*(e.y*e.z+e.w*e.x))},t.ComputeBlendingSpeed=function(e,t){return 1/(e*t)},t.ParseColor3=function(t,n){void 0===n&&(n=null);var a=null;return a=null!=t&&null!=t.r&&null!=t.g&&null!=t.b?new e.Color3(t.r,t.g,t.b):n},t.ParseColor4=function(t,n){void 0===n&&(n=null);var a=null;return a=null!=t&&null!=t.r&&null!=t.g&&null!=t.b&&null!=t.a?new e.Color4(t.r,t.g,t.b,t.a):n},t.ParseVector2=function(t,n){void 0===n&&(n=null);var a=null;return a=null!=t&&null!=t.x&&null!=t.y?new e.Vector2(t.x,t.y):n},t.ParseVector3=function(t,n){void 0===n&&(n=null);var a=null;return a=null!=t&&null!=t.x&&null!=t.y&&null!=t.z?new e.Vector3(t.x,t.y,t.z):n},t.ParseVector4=function(t,n){void 0===n&&(n=null);var a=null;return a=null!=t&&null!=t.x&&null!=t.y&&null!=t.z&&null!=t.w?new e.Vector4(t.x,t.y,t.z,t.w):n},t.StartsWith=function(e,t){return 0===e.lastIndexOf(t,0)},t.EndsWith=function(e,t){return e.indexOf(t,e.length-t.length)!==-1},t.ReplaceAll=function(e,t,n){return e.replace(new RegExp(t,"g"),n)},t.EncodeBinay=function(t){var n=null,a=window;return a.msgpack?n=a.msgpack.encode(t):e.Tools.Warn("Failed to load msgpack library."),n},t.DecodeBinary=function(t){var n=null,a=window;return a.msgpack?n=a.msgpack.decode(t):e.Tools.Warn("Failed to load msgpack library."),null!=n?n:null},t.CompressToString=function(t){var n=null,a=window;return a.pako?n=a.pako.deflate(t,{to:"string"}):e.Tools.Warn("Failed to load pako library."),n},t.CompressToArray=function(t){var n=null,a=window;return a.pako?n=a.pako.deflate(t):e.Tools.Warn("Failed to load pako library."),n},t.DecompressToString=function(t){var n=null,a=window;return a.pako?n=a.pako.inflate(t,{to:"string"}):e.Tools.Warn("Failed to load pako library."),n},t.DecompressToArray=function(t){var n=null,a=window;return a.pako?n=a.pako.inflate(t):e.Tools.Warn("Failed to load pako library."),n},t}();e.Utilities=t}(BABYLON||(BABYLON={}));